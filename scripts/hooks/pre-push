#!/bin/bash
# pre-push hook for tangerine-theme
# Shows what's being pushed and reminds about auto-triggered site PRs
# WARNING ONLY - does not block

REMOTE="$1"
URL="$2"

# Skip in CI/automated contexts
if [ -n "$CI" ] || [ -n "$GITHUB_ACTIONS" ]; then
    exit 0
fi

# Colors
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
GREEN='\033[0;32m'
BOLD='\033[1m'
NC='\033[0m'

echo ""
echo -e "${BOLD}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo -e "${BOLD}PUSHING: tangerine-theme${NC}"
echo -e "${BOLD}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo ""

# Show what will be pushed
BRANCH=$(git rev-parse --abbrev-ref HEAD)
UPSTREAM=$(git rev-parse --abbrev-ref "@{u}" 2>/dev/null || echo "")

if [ -n "$UPSTREAM" ]; then
    COMMITS_AHEAD=$(git rev-list --count "$UPSTREAM..HEAD" 2>/dev/null || echo "0")
    if [ "$COMMITS_AHEAD" -gt 0 ]; then
        echo -e "${BLUE}Commits to push ($COMMITS_AHEAD):${NC}"
        git log --oneline "$UPSTREAM..HEAD"
        echo ""
    fi
fi

# Check for uncommitted changes
if [ -n "$(git status --porcelain)" ]; then
    echo -e "${YELLOW}WARNING: You have uncommitted changes${NC}"
    git status --short
    echo ""
fi

# Info about what happens next
if [ "$BRANCH" = "master" ]; then
    echo -e "${GREEN}After push, GitHub Actions will automatically:${NC}"
    echo "  1. Trigger site update workflows"
    echo "  2. Create PRs in shawnyeager-com and shawnyeager-share"
    echo "  3. Build FREE deploy previews"
    echo ""
    echo "Check PRs in ~3 minutes:"
    echo "  gh pr list --repo shawnyeager/shawnyeager-com --label theme-update"
    echo "  gh pr list --repo shawnyeager/shawnyeager-share --label theme-update"
fi

echo -e "${BOLD}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo ""

exit 0
