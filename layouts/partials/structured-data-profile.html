{{/*
Purpose: Generates JSON-LD structured data for ProfilePage schema

Parameters: None (uses page context)

Context Expected:
- .Title, .Description - Page metadata
- .Permalink - Page URL
- .Site.Params.description - Fallback description
- .Site.Params.author.* - Author information (name, email, description, jobTitle, image)
- .Site.Params.author.sameAs.* - Social profile URLs (linkedin, github, nostr, podcast)
- .Site.BaseURL - Site base URL

Features:
- ProfilePage schema for personal/about pages
- mainEntity as Person with full author details
- Applied to pages with layout="now", layout="podcast", or type="page"
- Includes author image, jobTitle, description, and social profiles

Important Notes:
- Only runs on specific personal pages (not homepage, not content pages)
- mainEntity is the author (Person) that the page is about
- Helps search engines understand profile-related pages
*/}}

{{- if or (eq .Layout "now") (eq .Layout "podcast") (and (eq .Type "page") (ne .Layout "")) -}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ProfilePage",
  "name": "{{ .Title }}",
  "url": "{{ .Permalink }}",
  "description": "{{ if .Description }}{{ .Description }}{{ else }}{{ .Site.Params.description }}{{ end }}",
  "inLanguage": "en-US",
  "mainEntity": {
    "@type": "Person",
    "name": "{{ .Site.Params.author.name }}",
    "email": "{{ .Site.Params.author.email }}",
    "url": "{{ .Site.BaseURL }}"
    {{- with .Site.Params.author.description -}}
    ,"description": "{{ . }}"
    {{- end -}}
    {{- with .Site.Params.author.jobTitle -}}
    ,"jobTitle": "{{ . }}"
    {{- end -}}
    {{- with .Site.Params.author.image -}}
    ,"image": "{{ . | absURL }}"
    {{- end -}}
    {{- with .Site.Params.author.sameAs -}}
    ,"sameAs": [
      {{- $links := slice -}}
      {{- with .linkedin -}}{{ $links = $links | append . }}{{- end -}}
      {{- with .github -}}{{ $links = $links | append . }}{{- end -}}
      {{- with .nostr -}}{{ $links = $links | append . }}{{- end -}}
      {{- with .podcast -}}{{ $links = $links | append . }}{{- end -}}
      {{- delimit $links "\",\n      \"" | printf "\"%s\"" | safeJS }}
    ]
    {{- end -}}
  }
}
</script>
{{- end -}}
