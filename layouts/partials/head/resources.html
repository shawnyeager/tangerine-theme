{{/*
Purpose: CSS, fonts, RSS, sitemap, and favicon resources

Context Expected:
- .Site.Params.favicon_style - Favicon style ("solid" or "outlined")
- .Site.Title - Site title for RSS feed
- .OutputFormats - Available output formats (for RSS link)
*/}}

<!-- Preload critical resources -->
<link rel="preload" href="{{ "fonts/Satoshi-Variable.woff2" | relURL }}" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="{{ "fonts/Inter-Variable.woff2" | relURL }}" as="font" type="font/woff2" crossorigin>
{{- with .Params.hero_image -}}
  {{- $img := resources.Get . -}}
  {{- if $img -}}
    {{- $medium := $img.Resize "1024x" -}}
    {{- $avif := $medium.Process "avif q80" -}}
<link rel="preload" href="{{ $avif.RelPermalink }}" as="image" type="image/avif">
  {{- end -}}
{{- end -}}
{{/* Concatenate tokens + main CSS, then minify and fingerprint */}}
{{- $tokens := resources.Get "css/_tokens.css" -}}
{{- $main := resources.Get "css/main.css" -}}
{{- if and $tokens $main -}}
  {{- $combined := slice $tokens $main | resources.Concat "css/bundle.css" -}}
  {{- $cssMinified := $combined | resources.Minify -}}
  {{- $cssFingerprinted := $cssMinified | resources.Fingerprint -}}
  <link rel="preload" href="{{ $cssFingerprinted.RelPermalink }}" as="style" integrity="{{ $cssFingerprinted.Data.Integrity }}">
{{- else -}}
  {{/* Fallback if files missing */}}
  <link rel="preload" href="{{ "css/main.css" | relURL }}" as="style">
{{- end -}}

<!-- CSS -->
{{- if and $tokens $main -}}
  {{- $combined := slice $tokens $main | resources.Concat "css/bundle.css" -}}
  {{- $cssMinified := $combined | resources.Minify -}}
  {{- $cssFingerprinted := $cssMinified | resources.Fingerprint -}}
  <link rel="stylesheet" href="{{ $cssFingerprinted.RelPermalink }}" integrity="{{ $cssFingerprinted.Data.Integrity }}">
{{- else -}}
  <link rel="stylesheet" href="{{ "css/main.css" | relURL }}">
{{- end -}}

<!-- RSS Feed -->
{{ with .OutputFormats.Get "rss" -}}
{{ printf `<link rel="%s" type="%s" href="%s" title="%s" />` .Rel .MediaType.Type .Permalink $.Site.Title | safeHTML }}
{{ end -}}

<!-- Sitemap -->
<link rel="sitemap" type="application/xml" href="{{ "sitemap.xml" | absURL }}" title="Sitemap">

<!-- Favicons -->
{{- $faviconStyle := .Site.Params.favicon_style | default "solid" -}}
{{- $faviconPath := printf "favicons/%s" $faviconStyle -}}
<!-- High-res PNG for Google Search (padded for circular crop on mobile) -->
{{- with resources.Get (printf "%s/icon-192.png" $faviconPath) }}
  {{- with resources.Copy "icon-192.png" . }}
<link rel="icon" type="image/png" sizes="192x192" href="{{ .RelPermalink }}">
  {{- end }}
{{- end }}
<!-- SVG favicon for modern browsers (best quality, scalable) -->
{{- with resources.Get (printf "%s/favicon.svg" $faviconPath) }}
  {{- with resources.Copy "favicon.svg" . }}
<link rel="icon" type="image/svg+xml" href="{{ .RelPermalink }}">
  {{- end }}
{{- end }}
<!-- PNG favicons for browser tabs -->
{{- with resources.Get (printf "%s/favicon-96x96.png" $faviconPath) }}
  {{- with resources.Copy "favicon-96x96.png" . }}
<link rel="icon" type="image/png" sizes="96x96" href="{{ .RelPermalink }}">
  {{- end }}
{{- end }}
{{- with resources.Get (printf "%s/favicon-32x32.png" $faviconPath) }}
  {{- with resources.Copy "favicon-32x32.png" . }}
<link rel="icon" type="image/png" sizes="32x32" href="{{ .RelPermalink }}">
  {{- end }}
{{- end }}
{{- with resources.Get (printf "%s/favicon-16x16.png" $faviconPath) }}
  {{- with resources.Copy "favicon-16x16.png" . }}
<link rel="icon" type="image/png" sizes="16x16" href="{{ .RelPermalink }}">
  {{- end }}
{{- end }}
<!-- ICO fallback for legacy browsers -->
{{- with resources.Get (printf "%s/favicon.ico" $faviconPath) }}
  {{- with resources.Copy "favicon.ico" . }}
<link rel="icon" type="image/x-icon" href="{{ .RelPermalink }}">
  {{- end }}
{{- end }}
{{- with resources.Get (printf "%s/apple-touch-icon.png" $faviconPath) }}
  {{- with resources.Copy "apple-touch-icon.png" . }}
<link rel="apple-touch-icon" sizes="180x180" href="{{ .RelPermalink }}">
  {{- end }}
{{- end }}
<!-- Publish webmanifest icons (no link tags, just publish to root) -->
{{- with resources.Get (printf "%s/icon-512.png" $faviconPath) }}
  {{- $_ := (resources.Copy "icon-512.png" .).RelPermalink }}
{{- end }}
{{- with resources.Get (printf "%s/icon-maskable.png" $faviconPath) }}
  {{- $_ := (resources.Copy "icon-maskable.png" .).RelPermalink }}
{{- end }}
<link rel="manifest" href="{{ "site.webmanifest" | relURL }}">
