{{/*
Purpose: Renders site footer with optional email signup form and navigation links

Parameters: None (uses site and page context)

Context Expected:
- .Kind - Page kind (hides signup on 404 pages)
- .Params.hide_footer_signup - Frontmatter flag to hide signup on specific pages
- .Site.Params.show_email_signup - Global toggle for email signup feature
- .Site.Params.email_signup_text - Subscription form intro text
- .Site.Params.email_signup_action - Form submission URL (e.g., Buttondown API endpoint)
- .Site.Params.plausible_form_event - Analytics event name for form submission
- .Site.Params.plausible_events.* - Event names for link tracking
- .Site.Params.nostr, .github, .author.email - Social/contact links
- .Site.Params.secondary_site_url/name - Cross-site navigation (.com ↔ .notes)

Features:
- Conditionally displays email subscription form
- Cross-site navigation with event tracking
- Social and contact links
- Plausible analytics integration for button/link clicks
- Accessibility: sr-only label, aria-describedby, proper input types

Important Notes:
- Email form hidden on 404 pages and pages with hide_footer_signup: true
- Plausible event tracking via class="plausible-event-name=EventName"
- Form targets "popupwindow" for Buttondown compatibility
- role="contentinfo" removed (redundant - HTML5 footer has implicit contentinfo role)
*/}}

<footer class="site-footer" aria-label="Site footer">
    <div class="site-footer-inner">
        {{/* Email subscription form (parameterized) */}}
        {{ if and .Site.Params.show_email_signup (not (eq .Kind "404")) (not .Params.hide_footer_signup) }}
        <div class="email-subscription">
            <p id="email-intro" class="email-signup-intro">{{ .Site.Params.email_signup_text | default "I send new essays and updates via email." }}</p>
            <form class="email-form" action="{{ .Site.Params.email_signup_action }}" method="post" target="popupwindow">
                <label for="email-subscribe" class="sr-only">Email address</label>
                <input type="email" id="email-subscribe" name="email" placeholder="you@example.com" required aria-describedby="email-intro" autocomplete="email" inputmode="email" title="Please enter a valid email address" spellcheck="false">
                <button type="submit"{{ with .Site.Params.plausible_form_event }} class="plausible-event-name={{ . }}"{{ end }}>Subscribe</button>
            </form>
        </div>
        {{ end }}

        {{/* Footer links (supports both primary_site and secondary_site params) */}}
        <div class="footer-links">
            {{ with .Site.Params.nostr }}<a href="{{ . }}">Nostr</a>{{ end }}
            {{ with .Site.Params.github }}<a href="{{ . }}">GitHub</a>{{ end }}
            {{ with .Site.Params.secondary_site_url }}
                <a href="{{ . }}"{{ with $.Site.Params.plausible_events.cross_site_nav }} class="plausible-event-name={{ . }}"{{ end }}>{{ $.Site.Params.secondary_site_name }} <span aria-hidden="true">→</span></a>
            {{ end }}
            {{ with .Site.Params.author.email }}
                <a href="mailto:{{ . }}"{{ with $.Site.Params.plausible_events.contact_email }} class="plausible-event-name={{ . }}"{{ end }}>Email</a>
            {{ end }}
        </div>
    </div>
</footer>
