{{/*
Purpose: Renders main navigation menu with active state highlighting

Parameters: None (uses page context and site menus)

Context Expected:
- .Site.Menus.main - Main menu items defined in site config
- .RelPermalink - Current page URL
- .Section - Current section (e.g., "essays", "notes")
- .Type - Current page type (including taxonomy types like "topics", "tags")

Features:
- Highlights active menu item with class="active"
- Active state logic handles multiple cases:
  1. Direct match: current page URL equals menu item URL
  2. /writing/ link: highlights for essays, notes, and taxonomy pages
  3. /essays/ link: highlights for essays and taxonomy pages (single-type sites)
  4. /notes/ link: highlights for notes and taxonomy pages (single-type sites)
- Accessibility: aria-label for context

Important Notes:
- Supports both unified "Writing" nav (multi-type sites) and separate section nav
- On multi-type sites with /writing/, taxonomy pages highlight "Writing"
- On single-type sites, taxonomy pages highlight the content section
*/}}

<nav aria-label="Main navigation">
    {{- $currentPage := . -}}
    {{- $isTaxonomyPage := or (eq $currentPage.Type "topics") (eq $currentPage.Type "tags") -}}
    {{- $isContentPage := or (eq $currentPage.Section "essays") (eq $currentPage.Section "notes") -}}
    {{- range .Site.Menus.main -}}
        {{- $isCurrentURL := eq $currentPage.RelPermalink .URL -}}
        {{- $isWritingActive := and (eq .URL "/writing/") (or $isContentPage $isTaxonomyPage) -}}
        {{- $isEssaysActive := and (eq .URL "/essays/") (or (eq $currentPage.Section "essays") $isTaxonomyPage) -}}
        {{- $isNotesActive := and (eq .URL "/notes/") (or (eq $currentPage.Section "notes") $isTaxonomyPage) -}}
        {{- $isActive := or $isCurrentURL $isWritingActive $isEssaysActive $isNotesActive -}}
    {{- $isExternal := or (hasPrefix .URL "http://") (hasPrefix .URL "https://") -}}
    <a href="{{ if $isExternal }}{{ .URL }}{{ else }}{{ .URL | relURL }}{{ end }}"{{ if $isActive }} class="active"{{ end }}{{ if $isExternal }} target="_blank" rel="noopener"{{ end }}>{{ .Name }}</a>
    {{- end }}
</nav>
