/*
 * TANGERINE THEME - Main Stylesheet
 * Shared design system for shawnyeager.com and notes.shawnyeager.com
 *
 * TABLE OF CONTENTS
 * -----------------
 * 1. FONTS           (line ~30)        - Web font loading (Satoshi, Inter)
 * 2. TOKENS          (line ~56)        - CSS custom properties, spacing system
 * 3. RESET           (line ~241)       - Base styles, brand bar
 * 4. TYPOGRAPHY      (line ~293)       - Heading hierarchy, body text
 * 5. LINKS           (line ~420)       - Link styles, focus states, link hierarchy
 * 6. LAYOUT          (line ~641)       - Container, header/footer spacing
 * 7. FOOTER          (line ~731)       - Site footer, newsletter signup
 * 8. HOMEPAGE        (line ~854)       - Homepage sections (bio, latest essay, podcast)
 * 9. COMPONENTS      (line ~931)       - Cards, link-grid, topic tags
 * 10. ESSAYS         (line ~1140)      - Essay listings, single essay pages
 * 11. MARKDOWN       (line ~1337)      - Content body styles (nested CSS)
 * 12. PAGE-SPECIFIC  (line ~1723)      - Page layouts, pagination, contact, skip links
 * 13. UTILITIES      (line ~1862)      - Helper classes (sr-only, hidden, etc)
 * 14. DARK MODE      (line ~1884)      - Theme toggle & system preference overrides
 * 15. PRINT          (line ~2014)      - Print styles
 * 16. MEDIA EMBEDS   (line ~2028)      - YouTube, video captions
 * 17. MOBILE         (line ~2109)      - Responsive breakpoints
 * 18. V4V PAGE       (line ~2138)      - Value for Value payment page
 *
 * Line numbers are approximate. Update when making significant structural changes.
 */

/* ==========================================================================
   1. FONTS - Web Font Loading

   Dual-font system for visual hierarchy:
   - Satoshi (43KB): Headings, nav, section labels - clear weight hierarchy
   - Inter (352KB): Body text, lists, blockquotes - optimal readability

   Strategy: font-display: swap ensures web fonts always render
   ========================================================================== */

@font-face {
    font-family: 'Satoshi';
    font-weight: 300 900;
    font-style: normal;
    font-display: swap;
    src: url('/fonts/Satoshi-Variable.woff2') format('woff2-variations');
}

@font-face {
    font-family: 'Inter';
    font-weight: 100 900;
    font-style: normal;
    font-display: swap;
    src: url('/fonts/Inter-Variable.woff2') format('woff2-variations');
}

/* ==========================================================================
   2. TOKENS - CSS Custom Properties (Design Tokens)

   All design decisions tokenized for consistency and theming.
   Uses CSS light-dark() for automatic dark mode support.

   SPACING SCALE (8px base grid):
   --space-xs:  8px  - Tight grouping within elements
   --space-sm:  12px - Related elements (CTAs, internal spacing)
   --space-md:  16px - Default spacing (paragraphs, list items)
   --space-lg:  24px - Section internal spacing
   --space-xl:  32px - Section breaks
   --space-2xl: 48px - Major separations (header→main, main→footer)
   --space-3xl: 64px - Page header element stacks

   SPACING PHILOSOPHY:
   - Frame edges (header/footer padding): --space-xl (32px)
   - Section gaps: --space-2xl (48px)
   - Interior spacing: varies by component semantics
   - Mobile: interior scales down, frame/sections stay generous
   ========================================================================== */

:root {
    /* Color Scheme - Signals browser to adapt UI elements (scrollbars, form controls) */
    color-scheme: dark light;

    /* Brand Colors - Trust Revolution Orange
       Visual brand: #F84200 (used in brand bar, podcast art)
       Text implementation: #d63900 light / #FF5733 dark (WCAG AA compliant) */
    --brand-orange: light-dark(#d63900, #FF5733);
    --brand-orange-hover: light-dark(#bf3300, #FF6B47);

    /* Text Colors - WCAG AA compliant */
    --text-primary: light-dark(#1a1a1a, #f0f0f0);
    --text-secondary: light-dark(#444, #c8c8c8);
    --text-meta: light-dark(#666, #a8a8a8);
    --text-subtle: light-dark(#767676, #b0b0b0);
    --text-bold: light-dark(#1a1a1a, #ffffff);
    --text-on-brand: #1a1a1a;  /* Dark text for brand-color backgrounds (skip-link, buttons on orange) */
    --highlight-bg: light-dark(#fef3cd, #443818);  /* soft yellow / amber */
    --border-color: light-dark(#d5d5d5, #505050);
    --background-body: light-dark(#ffffff, #1e1e1e);
    --background-card: light-dark(#f5f5f5, #2a2a2a);

    /* Typography - Dual font system */
    --font-heading: 'Satoshi', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    --font-body: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    --font-monospace: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
    --line-height-body: 1.5;
    --line-height-title: 1.15;  /* Tight line-height for large display titles */

    /* Font Weights */
    --font-weight-light: 300;     /* Lighter weight for dark mode */
    --font-weight-normal: 400;
    --font-weight-body: light-dark(300, 250);  /* Body text - light mode uses light weight, dark mode slightly lighter */
    --font-weight-list-title: 450;  /* List titles - overridden to 300 in dark mode */
    --font-weight-medium: 500;
    --font-weight-semibold: 600;
    --font-weight-bold: 700;

    /* Letter Spacing */
    --letter-spacing-tight-xl: -0.03em;
    --letter-spacing-tight-lg: -0.025em;
    --letter-spacing-tight-md: -0.02em;
    --letter-spacing-normal: normal;
    --letter-spacing-wide: 0.05em;
    --letter-spacing-body: -0.01em;

    /* =======================================================================
       VERTICAL RHYTHM SYSTEM

       Base unit: 8px grid
       Philosophy: Balanced hierarchy without excessive whitespace
       Design goal: Content > structure. Clear visual hierarchy that serves
                    readability without feeling cramped or airy.

       TOKEN HIERARCHY (Semantic Meaning):
       --space-xs (8px):   Tight grouping within elements
       --space-sm (12px):  Related elements (CTAs, internal spacing)
       --space-md (16px):  Default spacing (paragraphs, list items, small headings)
       --space-lg (24px):  Section internal spacing (meta groups, subsection headers)
       --space-xl (32px):  Section breaks (page titles, content footers, back links)
       --space-2xl (48px): Major separations (header→main, main→footer, homepage sections)
       --space-3xl (64px): Page header element stacks (meta+title+first heading)

       USAGE RULES:
       1. Header-to-main gap: Always 2xl (48px) via header margin-bottom
       2. Main-to-footer gap: Always 2xl (48px) via footer margin-top
       3. Sections use margin-bottom: 0 (footer controls final gap)
       4. Content headings: H2 (xl/32px top), H3 (lg/24px top), H4 (md/16px top)
       5. First heading after page header: margin-top: 0 (header provides spacing)
       6. Never stack margins - one element controls the gap
       ======================================================================= */

    /* Spacing Tokens */
    --space-label-gap: 0.25rem;  /* 4px - Label-to-value gap in info pairs */
    --space-xs: 0.5rem;          /* 8px - Tight grouping within elements */
    --space-sm: 0.75rem;         /* 12px - Related elements (CTAs, internal spacing) */
    --space-md: 1rem;            /* 16px - Default spacing (paragraphs, list items, small headings) */
    --space-lg: 1.5rem;          /* 24px - Section internal spacing (meta groups, subsection headers) */
    --space-xl: 2rem;            /* 32px - Section breaks (page titles, content footers, back links) */
    --space-2xl: 3rem;           /* 48px - Major separations (header→main, main→footer, homepage sections) */
    --space-3xl: 4rem;           /* 64px - Page header element stacks (meta+title+first heading sequences) */
    --container-mobile-h-padding: 1.25rem;  /* 20px - Mobile horizontal edges */
    --icon-optical-adjust: 0.25rem;         /* 4px - SVG/icon alignment nudges */

    /* Typography spacing - heading proximity ratios (don't scale with viewport)
       Headings need more space above to associate with content below */
    --heading-above-lg: 1.5rem;   /* 24px - h2 section breaks */
    --heading-below-lg: 1rem;     /* 16px - maintains 1.5:1 ratio */
    --heading-above-md: 1rem;     /* 16px - h3 subsection breaks */
    --heading-below-md: 0.75rem;  /* 12px - maintains 1.33:1 ratio */
    --heading-above-sm: 0.75rem;  /* 12px - h4 minor breaks */
    --heading-below-sm: 0.5rem;   /* 8px - maintains 1.5:1 ratio */

    /* Component Sizing */
    --content-max-width: 700px;
    --card-padding: var(--space-xl);
    --border-radius-interactive: 4px;
    --border-radius-code: 4px;
    --brand-bar-height: 3px;
    --table-cell-padding: 0.75rem 1rem;
    --qr-size: 250px;
    --border-width-emphasis: 2px;

    /* Z-index Scale */
    --z-brand-bar: 9999;
    --z-skip-link: 10000;

    /* Transitions */
    --transition-fast: 0.3s ease;

    /* Link Styling */
    --underline-offset: 0.2em;
    --underline-thickness: 1px;
    --underline-opacity: 50%;

    /* Content Elevation */
    --shadow-content-light: light-dark(0 1px 3px rgba(0, 0, 0, 0.15), 0 2px 4px rgba(0, 0, 0, 0.4));

    /* Syntax Highlighting */
    --syntax-keyword: light-dark(#0066aa, #6cb6ff);
    --syntax-function: light-dark(#6f42c1, #d2a8ff);
    --syntax-string: light-dark(#aa5d00, #e9b872);
    --syntax-operator: light-dark(#555555, #b0b0b0);
    --syntax-default: light-dark(#1a1a1a, #d0d0d0);

    /* Typography - Heading colors (enhanced contrast in dark mode) */
    --text-heading-h2: light-dark(#1a1a1a, #ffffff);
    --text-heading-h3: light-dark(#1a1a1a, #ebebeb);
    --text-heading-h4: light-dark(#1a1a1a, #e0e0e0);
    --text-heading-h5: light-dark(#1a1a1a, #d8d8d8);
    --code-background: light-dark(#f5f5f5, #1e1e1e);

    /* Typography Scale (Perfect Fourth: 1.333) */
    --font-xs: 0.75rem;
    --font-sm: 0.875rem;
    --font-code: 0.9rem;          /* Monospace code */
    --font-base: 1rem;
    --font-lg: 1.125rem;
    --font-lg-plus: 1.0625rem;    /* Bio/intro text (17px) */
    --font-xl: 1.333rem;
    --font-2xl: 1.777rem;

    /* Custom Typography Sizes */
    --font-custom-32: 2rem;
    --font-custom-24: 1.5rem;

    /* Border Width */
    --border-width: 1px;
    --border-width-accent: 4px;
    --border-height-thin: 1px;

    /* Content Element Sizing */
    --podcast-art-size: 150px;
    --button-min-width-lg: 85px;
    --skip-link-max-width: 260px;
    --image-size-lg: 200px;
}

/* Manual Theme Override - User can force light or dark mode via 'd' keyboard toggle
   The light-dark() function automatically selects values based on color-scheme */
html[data-theme="light"] { color-scheme: light; }
html[data-theme="dark"] { color-scheme: dark; }

/* ==========================================================================
   3. RESET - Base Styles & Browser Normalization
   ========================================================================== */

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html {
    overflow-y: scroll; /* Prevent horizontal shift when scrollbar appears/disappears */
}

body {
    font-family: var(--font-body);
    font-size: var(--font-base);
    font-weight: var(--font-weight-body);
    line-height: var(--line-height-body);
    color: var(--text-primary);
    background: var(--background-body);
    transition: background-color var(--transition-fast), color var(--transition-fast);
    letter-spacing: var(--letter-spacing-body);
}

code,
pre,
.info-pair code {
    letter-spacing: normal;
}

.info-pair code {
    display: inline-block;
    max-width: 100%;
    white-space: pre-line;
}

/* Brand Bar - Fixed orange strip at top of viewport
   Visual brand element, not functional navigation
   -------------------------------------------------- */

body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: var(--brand-bar-height);
    background: var(--brand-orange);
    z-index: var(--z-brand-bar);
}

/* ==========================================================================
   4. TYPOGRAPHY - Heading Hierarchy & Body Text
   ========================================================================== */

/*
 * Heading Letter-Spacing Strategy:
 * - Base: All headings use tight-md (-0.01em) for comfortable reading
 * - H1: Override to tight-lg (-0.02em) because larger text needs tighter spacing
 * - .site-title: Override to normal (0) for brand name readability
 */
h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-heading);
    letter-spacing: var(--letter-spacing-tight-md);
    color: var(--text-primary);
}

h1 {
    font-size: var(--font-custom-32);
    font-weight: var(--font-weight-medium);
    margin-bottom: var(--space-xl);
    letter-spacing: var(--letter-spacing-tight-lg);
}

/* Homepage display title - large, prominent headline */
h1.display-title {
    font-size: var(--font-custom-32);
    font-weight: var(--font-weight-medium);
    line-height: var(--line-height-title);
    margin-top: 0;
    margin-bottom: var(--space-md);
    letter-spacing: var(--letter-spacing-tight-lg);
}

/* Home link square - 24x24px solid orange square */
.home-link {
    display: flex;
    align-items: center;
}

.home-square {
    display: block;
    width: 24px;
    height: 24px;
    background-color: var(--brand-orange);
}

.home-square--outlined {
    background-color: transparent;
    border: 3px solid var(--brand-orange);
}

.home-link:hover .home-square {
    opacity: 0.8;
}


/* Global headings - use typography tokens for tight, consistent spacing */
h2 {
    font-size: var(--font-custom-24);
    font-weight: var(--font-weight-semibold);
    margin-top: var(--heading-above-lg);
    margin-bottom: var(--heading-below-lg);
}

h3 {
    font-size: var(--font-lg);
    font-weight: var(--font-weight-semibold);
    margin-top: var(--heading-above-md);
    margin-bottom: var(--heading-below-md);
}

h4 {
    font-size: var(--font-lg);
    font-weight: var(--font-weight-semibold);
    margin-top: var(--heading-above-sm);
    margin-bottom: var(--heading-below-sm);
}

h5, h6 {
    font-size: var(--font-base);
    font-weight: var(--font-weight-semibold);
    margin-top: var(--space-lg);
    margin-bottom: var(--space-xs);
}

/* CTA + heading: let heading's natural margin provide spacing (no adjustment needed) */

.podcast-content h3 {
    margin-top: var(--space-2xl);
}

p {
    margin-bottom: var(--space-md);
    color: var(--text-secondary);
    font-weight: var(--font-weight-body);
}

/* Action link spacing now controlled by shortcode classes (.cta-link, .download-link, .back-link)
   via negative margin-top - see Link Hierarchy section */

ul {
    margin: var(--space-md) 0;
    padding-left: var(--space-lg);
}

li {
    margin-bottom: var(--space-xs);
    line-height: var(--line-height-body);
    color: var(--text-secondary);
    font-weight: var(--font-weight-body);
}

/* Bold text in page-body content - enhanced visibility */
.page-body strong,
.page-body b {
    font-weight: var(--font-weight-semibold);
    color: var(--text-bold);
}

/* Highlighted text (markdown ==text==) */
mark {
    background-color: var(--highlight-bg);
    color: var(--text-primary);
    padding: 0.2em 0.4em;
    border-radius: var(--border-radius-code);
}

/* ==========================================================================
   5. LINKS - Link Styles, Focus States, Link Hierarchy
   ========================================================================== */

a {
    color: var(--brand-orange);
    text-decoration: none;
    transition: color var(--transition-fast);
}

a:hover {
    color: var(--brand-orange-hover);
    text-decoration: underline;
    text-decoration-color: color-mix(in srgb, var(--brand-orange-hover) var(--underline-opacity), transparent);
    text-decoration-thickness: var(--underline-thickness);
    text-underline-offset: var(--underline-offset);
}

/* Navigation links - no underline on hover (clear navigation zones) */
header a:hover,
.footer-links a:hover,
.skip-link:hover {
    text-decoration: none;
}

/* Arrow alignment in links - both forward (→) and back (←) arrows */
a span[aria-hidden="true"] {
    display: inline-block;
    vertical-align: middle;
    text-decoration: none;
}

/* Focus Indicators - Keyboard Navigation Accessibility
   -------------------------------------------------- */

/* Remove default outline, replace with custom focus-visible styles */
a:focus {
    outline: none;
}

/* Visible focus indicators for keyboard navigation only */
a:focus-visible,
button:focus-visible,
input:focus-visible,
textarea:focus-visible,
select:focus-visible,
[tabindex]:focus-visible {
    outline: 2px solid var(--brand-orange);
    outline-offset: 2px;
    border-radius: 2px;
}

/* Reduced Motion Support - Accessibility
   -------------------------------------------------- */

@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }

    /* Skip link should still appear for accessibility */
    .skip-link:focus {
        transition: none;
    }
}

/* Link Hierarchy System - Intent-based link categories

   PRIMARY CTAs (.cta-link, .all-essays, .all-notes, .podcast-links a)
   - Orange with arrows (→), color lightens on hover
   - Display: inline-flex with gap for arrow spacing

   SECONDARY/DOWNLOAD LINKS (.download-link, .link-grid a)
   - Gray/secondary color, orange on hover
   - No underline at rest, none on hover

   INLINE CONTENT LINKS (.info-value, body links)
   - Orange, underline appears on hover
   ========================================================================== */

/* Shared transition for all branded links */
.cta-link,
.all-essays,
.all-notes,
.podcast-links a,
.essay-footer a,
.pagination-prev,
.pagination-next,
.download-link,
.link-grid a {
    text-decoration: none;
    transition: color var(--transition-fast);
}

/* CTA Links - Primary action links WITH arrows (→)
   Usage: "Read more →", "All essays →", "Subscribe to newsletter →" */
.cta-link,
.all-essays,
.all-notes,
.podcast-links a,
.essay-footer a,
.pagination-prev,
.pagination-next {
    font-family: var(--font-heading);
    color: var(--brand-orange);
    font-weight: var(--font-weight-medium);
    display: inline-flex;
    align-items: center;
    gap: 0.125rem;
}

/* Action links: block display for margin control, tight spacing above */
.cta-link {
    display: flex;  /* Block-level flex for margin-top to work */
    width: fit-content;
    margin-top: calc(-1 * var(--space-label-gap));  /* Pull up 4px: 16px para - 4px = 12px gap */
    margin-bottom: 0;  /* Following element's margin-top provides spacing */
}

/* CTAs inside paragraphs: inline, no margins */
p .cta-link {
    display: inline-flex;
    margin-top: 0;
    white-space: nowrap;
}

/* Hover state for all primary CTAs - no underline (arrows would be underlined) */
.cta-link:hover,
.all-essays:hover,
.all-notes:hover,
.podcast-links a:hover,
.essay-footer a:hover,
.pagination-prev:hover,
.pagination-next:hover {
    color: var(--brand-orange-hover);
    text-decoration: none;
}

/* Underline link text (not arrow) on hover */
.cta-link:hover .link-text,
.all-essays:hover .link-text,
.all-notes:hover .link-text,
.podcast-links a:hover .link-text,
.essay-footer a:hover .link-text,
.pagination-prev:hover .link-text,
.pagination-next:hover .link-text {
    text-decoration: underline;
    text-decoration-color: color-mix(in srgb, var(--brand-orange-hover) var(--underline-opacity), transparent);
    text-decoration-thickness: var(--underline-thickness);
    text-underline-offset: var(--underline-offset);
}

/* Download Links - Secondary utility style for downloads
   Usage: "Download contact card", "Download ASCII key"
   Gray, underlined, less prominent than CTAs */
.download-link {
    color: var(--text-meta);
    font-size: var(--font-base);
    font-weight: var(--font-weight-normal);
    text-decoration: underline;
    text-decoration-color: color-mix(in srgb, var(--text-meta) var(--underline-opacity), transparent);
    text-decoration-thickness: var(--underline-thickness);
    text-underline-offset: var(--underline-offset);
    transition: color var(--transition-fast);
    display: block;
    width: fit-content;
    margin-top: var(--space-sm);
}

/* Stacked action links: match back-link spacing */
.cta-link + .cta-link,
.cta-link + .download-link,
.download-link + .cta-link,
.download-link + .download-link {
    margin-top: var(--space-lg);
}

/* Freestanding action links after info blocks: breathing room */
.info-pair:has(+ .cta-link),
.info-pair:has(+ .download-link) {
    margin-bottom: var(--space-lg);
}

/* New section after action links */
.cta-link + .info-pair,
.download-link + .info-pair {
    margin-top: var(--space-xl);
}

/* Contact section spacing from intro text */
.contact-section {
    margin-top: var(--space-lg);
}

/* Service Links - Orange, no arrows
   Usage: Podcast platforms, social links */
.link-grid a {
    color: var(--brand-orange);
    font-weight: var(--font-weight-medium);
    font-size: var(--font-base);
}

/* Hover states */
.download-link:hover {
    color: var(--brand-orange-hover);
    text-decoration: none;
}

.link-grid a:hover {
    color: var(--brand-orange-hover);
    text-decoration: underline;
    text-decoration-color: color-mix(in srgb, var(--brand-orange-hover) var(--underline-opacity), transparent);
    text-decoration-thickness: var(--underline-thickness);
    text-underline-offset: var(--underline-offset);
}

/* ==========================================================================
   6. LAYOUT - Container, Header/Footer Spacing
   ========================================================================== */

.container {
    max-width: var(--content-max-width);
    margin: 0 auto;
    padding: var(--space-xl) var(--space-md) 0 var(--space-md);
}

/* Header & Navigation
   -------------------------------------------------- */

body > .container:first-of-type {
    padding-bottom: 0;
}

/* Header/Footer Spacing Tokens - Frame edge spacing
   Footer tight gap uses explicit padding because line-height extends ABOVE
   text, not between the HR and content.
   -------------------------------------------------- */
:root {
    --section-gap: var(--space-2xl);          /* 48px - Interior section breaks */
    --header-gap-below: var(--space-xl);      /* 32px - Frame edge: header to content */
    --footer-gap-above: var(--space-xl);      /* 32px - Frame edge: content to footer HR */
    --footer-gap-tight: var(--space-sm);      /* 12px - Tight coupling: HR to footer content */
    --footer-gap-below: var(--space-xl);      /* 32px - Space between footer content and page bottom */
}

/* Page-level site header spacing (not article headers) */
body > .container > header {
    display: flex;
    justify-content: space-between;
    align-items: last baseline;
    margin-bottom: var(--header-gap-below);
}

.site-title {
    margin: 0;
    font-size: var(--font-lg);
    font-weight: var(--font-weight-semibold);
}

.site-title a {
    color: var(--text-primary);
    text-decoration: none;
}

.site-title a:hover {
    color: var(--brand-orange);
}

nav {
    font-family: var(--font-heading);
    font-size: var(--font-lg);  /* Match site-title size */
    display: flex;
    gap: var(--space-lg);
    margin-bottom: 0;
}

main .container {
    padding-top: 0;
}

/* Adaptive footer positioning for short pages
 *
 * Data sources:
 * - Statcounter: 1920×1080 (23%), 1366×768 common viewport heights
 * - Nielsen Norman: 57% viewing time above fold (~600-800px)
 *
 * Values:
 * - Floor 420px: mobile/small laptop minimum (600px viewport - 80px header - buffer)
 * - Preferred 70dvh: scales with dynamic viewport (adapts to mobile browser chrome)
 * - Ceiling 620px: keeps footer at fold line (~700px - 80px header)
 */
main {
    min-height: clamp(420px, 70dvh, 620px);
}

nav a {
    color: var(--text-secondary);
    font-weight: var(--font-weight-medium);
    text-decoration: none;

    &:hover,
    &.active {
        color: var(--brand-orange);
    }
}

/* ==========================================================================
   7. FOOTER - Site Footer & Newsletter Signup

   Unified footer zone: email signup form + site links.
   Uses frame-edge spacing (footer-gap-above/below tokens).
   ========================================================================== */

body > .container > footer {
    margin-top: var(--footer-gap-above);
    padding-top: var(--footer-gap-tight);
    padding-bottom: var(--footer-gap-below);
    /* 70% opacity: strong enough to anchor footer on short pages,
       soft enough to avoid visual heaviness (Material Design uses
       similar values for medium-emphasis elements) */
    border-top: var(--border-width) solid color-mix(in srgb, var(--border-color) 70%, transparent);
}

.email-signup-intro {
    color: var(--text-secondary);
    font-size: var(--font-base);
    line-height: var(--line-height-body);
    margin-bottom: var(--space-sm);
}

.email-form {
    display: flex;
    gap: var(--space-xs);
    align-items: stretch;
    margin-bottom: var(--space-md);  /* 16px to footer links */
    flex-wrap: nowrap;
}

.email-form input[type="email"] {
    padding: var(--space-xs) 0;  /* Compact vertical padding for inline form */
    border: none;
    border-bottom: var(--border-width) solid color-mix(in srgb, var(--border-color) 50%, transparent);
    border-radius: 0;
    font-size: var(--font-sm);
    font-family: var(--font-body);
    background: var(--background-body);
    color: var(--text-primary);
    flex: 1;
    max-width: var(--skip-link-max-width);
    transition: border-color var(--transition-fast);
}

.email-form input[type="email"]:focus {
    outline: none;
    border-bottom-color: var(--brand-orange);
}

/* Show validation hint only after user has typed something */
.email-form input[type="email"]:invalid:not(:placeholder-shown) {
    border-bottom-color: var(--brand-orange);
}

.email-form input[type="email"]::placeholder {
    color: var(--text-meta);
    opacity: 0.5;
}

.email-form button {
    padding: var(--space-xs) var(--space-md);
    background: transparent;
    color: var(--text-meta);
    border: var(--border-width) solid var(--text-meta);
    border-radius: var(--border-radius-interactive);
    font-size: var(--font-xs);
    font-weight: var(--font-weight-medium);
    font-family: inherit;
    cursor: pointer;
    transition: all var(--transition-fast);
    white-space: nowrap;
    flex-shrink: 0;
}

.email-form button:hover {
    border-color: var(--brand-orange);
    color: var(--brand-orange);
}

.footer-links {
    display: flex;
    gap: var(--space-md);
    flex-wrap: wrap;
    align-items: center;
}

.footer-links a {
    color: var(--text-meta);
    text-decoration: none;
    transition: color var(--transition-fast);
    font-size: var(--font-sm);
    font-family: var(--font-heading);
    display: inline-flex;
    align-items: center;
    gap: 0.125rem;

    &:hover {
        color: var(--brand-orange-hover);
    }
}

/* V4V icon tap target - pseudo-element creates 48x48 clickable area without affecting layout */
.footer-links a[aria-label="Value for value"] {
    position: relative;
}

/* Optical alignment - nudge SVG up to align with text x-height */
.footer-links a[aria-label="Value for value"] svg {
    vertical-align: middle;
}

.footer-links a[aria-label="Value for value"]::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 48px;
    height: 48px;
}

/* ==========================================================================
   8. HOMEPAGE - Homepage Sections (Bio, Latest Essay, Podcast Card)

   Section spacing uses bottom-margin only (no top margins to avoid stacking).
   Sections connect to footer via margin-bottom: 0 on last section.
   ========================================================================== */

.bio,
.notes-homepage-intro {
    margin-bottom: var(--section-gap);  /* 48px - gap to next section */
    color: var(--text-secondary);
    font-size: var(--font-lg-plus);  /* 17px - slightly larger than base for prominence */
    line-height: 1.45;  /* Match long-form content */
}

.bio p,
.notes-homepage-intro p {
    margin-bottom: var(--space-sm);
}


/* Override tight CTA spacing in bio - match paragraph spacing */
.bio p:has(+ .cta-link),
.notes-homepage-intro p:has(+ .cta-link) {
    margin-bottom: var(--space-sm);
}

/* Unified section header style */
.essay-section-header,
.section-label-small,
.topics h4 {
    font-family: var(--font-heading);
    font-size: var(--font-sm);
    font-weight: var(--font-weight-medium);
    letter-spacing: var(--letter-spacing-wide);
    text-transform: uppercase;
    color: var(--text-subtle);
    margin-bottom: var(--space-sm);  /* 24px - connects header to content */

    /* Override margin-top for semantic headings (h1/h2/h3) */
    &:is(h1, h2, h3) {
        margin-top: 0;
    }
}

/* Reduce spacing between section label and topic tags in topics section */
.topics .section-label-small {
    margin-bottom: var(--space-xs);  /* 8px - tight grouping with topic tags */
}

.latest-essay {
    margin-bottom: var(--section-gap);  /* 48px - gap to next section */

    /* Semantic heading: essay title (h3 under h2 section header) */
    h3 {
        font-size: var(--font-2xl);
        font-weight: var(--font-weight-medium);
        margin-top: 0;
        margin-bottom: var(--space-sm);  /* 16px - title to description */
        line-height: 1.3;

        a {
            color: var(--text-primary);

            &:hover {
                color: var(--brand-orange);
            }
        }
    }

    p {
        margin-bottom: var(--space-sm);
        font-size: var(--font-base);
        line-height: var(--line-height-body);
    }
}

/* ==========================================================================
   9. COMPONENTS - Cards, Link-Grid, Topic Tags

   Reusable UI components: podcast card, link-grid, RSS card, topic tags.
   Cards share base styling (padding, background, transitions).
   ========================================================================== */

/* Base card styling shared by podcast, services, and RSS cards */
.podcast,
.link-grid-card,
.rss-feed-card {
    padding: var(--card-padding);
    background: var(--background-card);
    transition: background-color var(--transition-fast);
    contain: layout style paint; /* Isolate rendering for better performance */
}

.podcast {
    margin-bottom: var(--space-2xl);

    /* Prevent double spacing at card bottom edge */
    > *:last-child {
        margin-bottom: 0;
    }
}

/* Link grid and RSS cards share spacing */
.link-grid-card,
.rss-feed-card {
    margin-bottom: var(--space-xl);
}

/* RSS Feed Card - relative positioning for absolute copy button */
.rss-feed-card {
    position: relative;
}

.rss-url {
    font-family: var(--font-monospace);
    font-size: var(--font-code);
    color: var(--text-primary);
    display: block;
    padding-right: var(--space-3xl);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.rss-copy-btn {
    position: absolute;
    right: var(--space-lg);
    top: 50%;
    transform: translateY(-50%);
    background: transparent;
    color: var(--text-secondary);
    border: var(--border-width) solid var(--border-color);
    padding: 0.4rem var(--space-sm);  /* Compact button */
    border-radius: var(--border-radius-interactive);
    cursor: pointer;
    font-weight: var(--font-weight-medium);
    font-size: var(--font-xs);
    transition: all var(--transition-fast);
    font-family: var(--font-heading);
}

.rss-copy-btn:hover {
    border-color: var(--brand-orange);
    color: var(--brand-orange);
}

.podcast-header {
    display: flex;
    gap: var(--space-lg);
    align-items: center;
}

.podcast-info {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);  /* 12px - episode info + CTAs as action cluster */
}

/* Content images - systematic elevation */
.page-body img {
    box-shadow: var(--shadow-content-light);
    transition: box-shadow var(--transition-fast);
}

.podcast-art {
    width: var(--podcast-art-size);
    height: var(--podcast-art-size);
    flex-shrink: 0;
    display: block;
}

.podcast img {
    box-shadow: none;
    border: none;
    outline: none;
}

.episode-tag {
    display: block;
    font-size: var(--font-sm);
    font-weight: var(--font-weight-normal);
    letter-spacing: var(--letter-spacing-wide);
    color: var(--text-meta);
}

.episode-hook {
    font-size: var(--font-lg);
    font-weight: var(--font-weight-medium);
    color: var(--text-primary);
}

.episode-guest {
    font-size: var(--font-base);
    font-weight: var(--font-weight-body);
    color: var(--text-primary);
}

.podcast-info .episode-info {
    display: flex;
    flex-direction: column;
}

.podcast-info .podcast-links {
    margin-top: 0;  /* gap on .podcast-info handles spacing */
}

.podcast-info p {
    color: var(--text-secondary);
    font-size: var(--font-base);
}

.podcast-links {
    display: flex;
    gap: var(--space-md);
    align-items: center;
}

.episode-meta {
    display: block;
}

.episode-meta .episode-guest,
.episode-meta .separator,
.episode-meta .episode-tag {
    display: inline;
}

.separator {
    color: var(--text-meta);
    padding: 0 var(--space-xs);
}

.link-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-md);
}

/* Topic Tags - Browseable topic navigation
   -------------------------------------------------- */

.topics {
    margin-bottom: var(--space-lg);  /* Section gap to essay list below */
}

/* When essays directly follow topics, remove essay list margin-top */
.topics + .recent-essays {
    margin-top: 0;
}

/* Keep section-label-medium different (year headers in notes) */
.recent-notes h3,
.section-label-medium {
    font-family: var(--font-heading);
    font-size: var(--font-base);
    font-weight: var(--font-weight-medium);
    letter-spacing: var(--letter-spacing-wide);
    text-transform: uppercase;
    color: var(--text-secondary);
    margin-bottom: var(--space-md);
    margin-top: var(--space-xl);
}

.recent-notes h3:first-child,
.section-label-medium:first-child {
    margin-top: 0;
}

.topic-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-sm);
    margin-bottom: 0;  /* Parent .topics controls spacing */

    a {
        color: var(--text-meta);
        text-decoration: none;
        font-size: var(--font-sm);

        &:hover {
            color: var(--brand-orange);
        }
    }
}

/* ==========================================================================
   10. ESSAYS - Essay/Note Listings & Single Pages

   List items: date + title flex layout with baseline alignment.
   Single pages: title + meta + body structure.
   ========================================================================== */

/* Section lists have no bottom margin - footer/next section provides spacing */
.recent-essays,
.recent-notes {
    margin-bottom: 0;
}

.page-title {
    font-size: var(--font-custom-32);
    font-weight: var(--font-weight-semibold);
    line-height: var(--line-height-title);
    margin-top: 0;
    margin-bottom: var(--space-xs);  /* Tight coupling to meta/subtitle; body controls gap via margin-top */
    letter-spacing: var(--letter-spacing-tight-xl);
}

.page-subtitle {
    font-size: var(--font-lg);
    color: var(--text-secondary);
    margin-top: 0;
    margin-bottom: var(--space-lg);
}

/* Content containers: margin-top collapses with meta/subtitle margin-bottom when present */
.page-body,
.podcast-content,
.topics,
.recent-notes {
    margin-top: var(--space-lg);
}

.essay-item,
.note-item {
    margin-bottom: var(--space-xs);
    contain: layout style paint; /* Isolate list items for better performance */

    a {
        color: var(--text-primary);
        text-decoration: none;
        display: flex;
        gap: var(--space-lg);
        line-height: 1.5;
        align-items: baseline;

        &:hover {
            color: var(--brand-orange);
        }
    }
}

time.essay-date,
time.note-date,
.essay-date,
.note-date {
    color: var(--text-meta);
    font-size: var(--font-sm);
    font-weight: var(--font-weight-normal);  /* Override body weight (450→400) */
    font-variant-numeric: tabular-nums;
    letter-spacing: -0.02em;  /* Tighten date spacing */
    flex-shrink: 0;
    white-space: nowrap;
}

.essay-title,
.note-title {
    flex: 1;
    font-weight: var(--font-weight-list-title);
    font-size: var(--font-base);
}

/* Full listing pages (/essays/, /notes/) - wider row spacing */
.full-list .essay-item,
.full-list .note-item {
    margin-bottom: var(--space-md);
}


/* Last item before CTA link doesn't need margin - CTA provides the gap */
.essay-item:last-of-type,
.note-item:last-of-type {
    margin-bottom: 0;
}

.all-essays,
.all-notes {
    margin-top: var(--space-md);  /* 16px - breathing room after list */
}

.topic-count {
    color: var(--text-secondary);
    font-size: var(--font-base);
    margin-bottom: var(--space-lg);  /* 24px - clear separation to essay list */
}

/* Single Essay/Note Page
   -------------------------------------------------- */

.essay-content,
.note-content {
    max-width: var(--content-max-width);
}

.page-meta {
    margin-bottom: var(--space-lg);  /* Breathing room before content */
    color: var(--text-meta);
    font-size: var(--font-sm);
    display: flex;
    align-items: center;
    gap: var(--space-xs);
}

.page-meta-separator {
    opacity: 0.5;
}

/* Essay/note titles - medium weight, size provides hierarchy */
.essay-title-single,
.note-title-single {
    font-size: var(--font-custom-32);
    font-weight: var(--font-weight-medium);
    line-height: var(--line-height-title);
    margin-bottom: var(--space-xs);  /* Tight coupling to metadata below */
    letter-spacing: var(--letter-spacing-tight-lg);
}

.essay-body,
.note-body,
.long-form {
    font-size: var(--font-lg);
    line-height: 1.45;  /* Tighter than body default (1.5) for optimal reading */

    /* Paragraphs */
    p {
        margin-bottom: var(--space-md);
        font-weight: var(--font-weight-normal);
        color: var(--text-primary);
    }

    /* Unordered lists */
    ul {
        margin: var(--space-md) 0;
        padding-left: var(--space-lg);
    }

    /* List items */
    li {
        margin-bottom: var(--space-xs);
        font-weight: var(--font-weight-normal);
        color: var(--text-primary);
    }

    /* Bold text - enhanced visibility */
    strong,
    b {
        font-weight: var(--font-weight-semibold);
        color: var(--text-bold);
    }

    /* Images - systematic elevation */
    img {
        box-shadow: var(--shadow-content-light);
        transition: box-shadow var(--transition-fast);
    }
}

/* Reading content uses primary color for optimal contrast */
.page-body p,
.latest-essay p,
.podcast p {
    color: var(--text-primary);
}

/* First heading after page header elements - reduce top margin to avoid excessive stacking
   Applies when meta/title/subtitle elements precede the first content heading */
.essay-content > header + .essay-body > h2:first-child,
.note-content > header + .note-body > h2:first-child,
.long-form > h2:first-child,
.long-form > h3:first-child {
    margin-top: 0;  /* No top margin - header elements provide spacing */
}

.podcast-content > h3:first-child {
    margin-top: var(--space-md);  /* 16px - tighter spacing for podcast layout */
}

/* Footer CTA spacing after essay/note content */
.essay-body + footer,
.note-body + footer {
    margin-top: var(--space-sm);  /* 8px - tight spacing like p:has(+ .cta-link) */
}

/* ==========================================================================
   11. MARKDOWN - Content Body Styles (CSS Nesting)

   Styles for Markdown-generated content within .essay-body and .note-body.
   Uses CSS nesting for scoped element styling.
   Includes: lists, blockquotes, code blocks, tables, footnotes, images.
   ========================================================================== */

.essay-body,
.note-body {
    /* Ordered Lists */
    ol {
        margin: var(--space-lg) 0;
        padding-left: var(--space-lg);

        li {
            margin-bottom: var(--space-xs);
        }
    }

    /* Nested Lists */
    li > ul,
    li > ol {
        margin: var(--space-xs) 0 0 0;
    }

    /* H6 special styling */
    h6 {
        margin-top: var(--space-md);
        text-transform: uppercase;
        letter-spacing: var(--letter-spacing-wide);
    }

    /* Blockquotes */
    blockquote {
        margin: var(--space-xl) 0;
        padding: var(--space-md) var(--space-lg);
        border-left: var(--border-width-accent) solid var(--brand-orange);
        background: var(--background-card);
        font-style: italic;
        color: var(--text-secondary);

        p {
            margin-bottom: var(--space-md);

            &:last-child {
                margin-bottom: 0;
            }
        }

        /* Nested blockquotes */
        blockquote {
            margin: var(--space-md) 0;
            border-left-color: var(--text-meta);
        }
    }

    /* Inline Code */
    code {
        font-family: var(--font-monospace);
        font-size: 0.9em;
        background: var(--background-card);
        padding: 0.2em 0.4em;
        border-radius: var(--border-radius-code);
        border: var(--border-width) solid var(--border-color);
        white-space: nowrap;
    }

    /* Code Blocks */
    pre {
        margin: var(--space-xl) 0;
        padding: var(--space-lg);
        background: var(--background-card);
        border: var(--border-width) solid var(--border-color);
        border-radius: var(--border-radius-code);
        overflow-x: auto;
        line-height: 1.5;

        code {
            background: none;
            padding: 0;
            border: none;
            border-radius: 0;
            font-size: 0.875rem;
        }
    }

    /* Syntax highlighted code (Hugo default) */
    .highlight {
        margin: var(--space-xl) 0;

        pre {
            margin: 0;
        }

        /* Syntax highlight color overrides - match code highlighter output colors */
        span[style*="color:#00a8c8"] {
            color: var(--syntax-keyword) !important;
        }

        span[style*="color:#75af00"] {
            color: var(--syntax-function) !important;
        }

        span[style*="color:#d88200"] {
            color: var(--syntax-string) !important;
        }

        span[style*="color:#f92672"] {
            color: var(--syntax-operator) !important;
        }

        span[style*="color:#111"] {
            color: var(--syntax-default) !important;
        }
    }

    /* Horizontal Rules */
    hr {
        margin: var(--space-2xl) 0;
        border: none;
        height: 1px;
        background: var(--border-color);
    }

    /* Tables */
    table {
        width: 100%;
        margin: var(--space-xl) 0;
        border-collapse: collapse;
        font-size: var(--font-base);

        th {
            padding: var(--table-cell-padding);
            text-align: left;
            font-weight: var(--font-weight-semibold);
            background: var(--background-card);
            border: var(--border-width) solid var(--border-color);

            &:last-child {
                text-align: right;
            }
        }

        td {
            padding: var(--table-cell-padding);
            border: var(--border-width) solid var(--border-color);

            &:last-child {
                text-align: right;
            }
        }

        tbody tr:nth-child(even) {
            background: var(--background-card);
        }
    }

    /* Task Lists */
    input[type="checkbox"] {
        margin-right: var(--space-xs);
        vertical-align: middle;
        appearance: none;
        width: 1.1em;
        height: 1.1em;
        border: 2px solid var(--border-color);
        border-radius: var(--border-radius-code);
        background: var(--background-card);
        cursor: default;
        position: relative;
        flex-shrink: 0;

        &:checked {
            background: var(--text-meta);
            border-color: var(--text-meta);

            &::after {
                content: '✓';
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                color: white;
                font-size: 0.9em;
                font-weight: var(--font-weight-bold);
                line-height: 1;
            }
        }
    }

    li:has(input[type="checkbox"]) {
        list-style: none;

        &::marker {
            content: '';
        }

        input[type="checkbox"] {
            margin-left: -1.5rem;
            margin-right: var(--space-sm);
        }
    }

    /* Definition Lists */
    dl {
        margin: var(--space-lg) 0;
    }

    dt {
        font-weight: var(--font-weight-semibold);
        margin-top: var(--space-md);

        &:first-child {
            margin-top: 0;
        }
    }

    dd {
        margin-left: var(--space-xl);
        margin-top: var(--space-xs);
        color: var(--text-secondary);
    }

    /* Footnotes */
    .footnotes {
        margin-top: var(--space-lg);
        margin-bottom: 0;  /* hr + li margins provide separation; avoid double-spacing before footer CTA */
        font-size: var(--font-sm);

        hr {
            margin: var(--space-lg) 0 var(--space-md) 0;
            opacity: 0.5;
        }

        ol {
            padding-left: var(--space-lg);
        }

        li {
            margin-bottom: var(--space-md);
            line-height: var(--line-height-body);
            color: var(--text-meta);
        }

        p {
            margin-bottom: var(--space-xs);
            color: var(--text-meta);
        }

        /* Subdued inline links - blend with footnote text, underline for affordance */
        /* Excludes backref arrows which keep their original orange styling */
        a:not(.footnote-backref) {
            color: var(--text-meta);
            text-decoration: underline;
            text-decoration-color: color-mix(in srgb, var(--text-meta) var(--underline-opacity), transparent);
            text-decoration-thickness: var(--underline-thickness);
            text-underline-offset: var(--underline-offset);

            &:hover {
                color: var(--brand-orange-hover);
                text-decoration-color: color-mix(in srgb, var(--brand-orange-hover) var(--underline-opacity), transparent);
            }
        }
    }

    /* Footnote back-references - subtle return arrows */
    .footnote-backref {
        margin-left: var(--space-xs);
        font-size: var(--font-base);
        opacity: 0.6;
    }

    .footnote-backref:hover {
        opacity: 1;
        text-decoration: none;
    }

    /* Images */
    img {
        max-width: 100%;
        height: auto;
        margin: var(--space-xl) 0;
        display: block;
    }

    /* Strikethrough */
    del {
        color: var(--text-meta);
        text-decoration: line-through;
    }

    /* Superscript & Subscript */
    sup,
    sub {
        font-size: 0.75em;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
    }

    sup {
        top: -0.5em;
    }

    sub {
        bottom: -0.25em;
    }

    /* Emphasis */
    em {
        font-style: italic;
    }
}

.essay-footer {
    margin-top: var(--space-md);
    padding-top: 0;
    border-top: none;
}

.essay-footer p {
    color: var(--text-secondary);
    margin-bottom: 0;
}

.essay-footer a {
    color: var(--brand-orange);
    text-decoration: none;
}

.essay-footer a:hover {
    color: var(--brand-orange-hover);
}

/* Action cluster: essay footer (V4V) + nav form a tight unit */
.essay-footer + .essay-nav {
    margin-top: 0;  /* No gap - same action block */
}

.essay-nav {
    border-bottom: none;
    padding-bottom: 0;
    margin-top: var(--space-sm);  /* Default when not following essay-footer */
    gap: 0;
}

.essay-nav .all-essays {
    color: var(--text-meta);
}

.essay-nav .all-essays:hover {
    color: var(--brand-orange);
}

.essay-acknowledgement {
    color: var(--text-meta);
    font-style: italic;
    font-size: var(--font-base);
    margin-bottom: 0;
}

/* Back links - unified styling for wrappers and standalone anchors */
.note-back-link,
.back-link,
.back-link-wrapper {
    margin-top: var(--space-lg);
}

.note-back-link a,
.back-link a,
.back-link-wrapper a,
a.back-link {
    color: var(--text-meta);
    text-decoration: none;
    font-size: var(--font-base);
    font-family: var(--font-heading);
    display: inline-flex;
    align-items: center;
    gap: 0.125rem;

    &:hover {
        color: var(--brand-orange);
        text-decoration: none;
    }
}

/* ==========================================================================
   12. PAGE-SPECIFIC - Page Layouts, Pagination, Contact, Skip Links

   Page-specific styling: /media bio boxes, /podcast images, pagination,
   contact display patterns, and skip link accessibility.
   ========================================================================== */

/* Bio boxes on /media page */
.bio-text {
    background: var(--background-card);
    padding: var(--space-lg);
    color: var(--text-primary);
    margin-bottom: var(--space-lg);
    line-height: var(--line-height-body);
    font-size: var(--font-base);
}

.bio-text p:last-child {
    margin-bottom: 0;
}

.bio-text .info-pair:last-child {
    margin-bottom: 0;
}

/* Page Content Wrappers
   -------------------------------------------------- */

.page-content {
    max-width: var(--content-max-width);
}

/* Podcast page images */
.podcast-content img {
    margin: 0 0 var(--space-md) 0;
    display: block;
}

.podcast-content > img:first-of-type {
    width: var(--podcast-art-size);
    height: var(--podcast-art-size);
}

/* Image size utility - used via shortcode variant param */
.img-lg {
    display: block;
    width: var(--image-size-lg) !important;
    height: var(--image-size-lg) !important;
    margin-bottom: var(--space-lg);
}

/* Pagination
   -------------------------------------------------- */

.pagination {
    margin-top: var(--space-2xl);
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: var(--space-md);
}

/* Pagination styles consolidated with CTA links above */

/* Contact Display Patterns - Utility pages (.info-pair, .info-label, .info-value)
   -------------------------------------------------- */

.info-pair {
    margin-bottom: var(--space-lg);
    display: flex;
    flex-direction: column;
    gap: var(--space-label-gap);

    /* Tighter spacing when followed by related download links */
    &:has(+ .download-link) {
        margin-bottom: var(--space-md);
    }

    /* Monospace code elements for fingerprints and keys - plain text, not links */
    code {
        font-family: var(--font-monospace);
        font-size: 0.9em;
        color: var(--text-primary);
        cursor: text;
    }
}

/* Media page contact section - tighter grouping for multiple contact methods */
#contact + .info-pair {
    margin-bottom: var(--space-lg);

    ~ .info-pair {
        margin-bottom: var(--space-lg);
    }
}

.info-label {
    font-weight: var(--font-weight-normal);
    color: var(--text-meta);
    font-size: var(--font-sm);
}

.info-value {
    color: var(--brand-orange);
    text-decoration: none;
    font-size: var(--font-base);
    transition: color var(--transition-fast);

    &:hover {
        color: var(--brand-orange-hover);
        text-decoration: underline;
        text-decoration-color: color-mix(in srgb, var(--brand-orange-hover) var(--underline-opacity), transparent);
        text-decoration-thickness: var(--underline-thickness);
        text-underline-offset: var(--underline-offset);
    }
}

/* Skip Links - Keyboard navigation accessibility
   -------------------------------------------------- */

.skip-link {
    position: fixed;
    top: 0;
    left: 0;
    background: var(--brand-orange);
    color: var(--text-on-brand);
    padding: var(--space-xs) var(--space-md);
    text-decoration: none;
    z-index: var(--z-skip-link);
    font-weight: var(--font-weight-medium);
    border-radius: 0 0 var(--border-radius-interactive) 0;
    transform: translateY(-100%);
    transition: transform var(--transition-fast);
}

.skip-link:focus {
    transform: translateY(0);
}

/* ==========================================================================
   13. UTILITIES - Helper Classes

   Utility classes: screen-reader only, etc.
   ========================================================================== */

.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
}

.hidden {
    display: none;
}

/* ==========================================================================
   14. DARK MODE - Theme Toggle & System Preference Overrides

   ARCHITECTURE NOTE - Theme toggle vs. CSS dark mode:
   PROBLEM: Theme toggle and CSS dark mode work differently:
   - Theme toggle: Sets data-theme="light|dark" attribute on <html>
   - Colors: Use light-dark() function which respects color-scheme property
   - CSS rules: html[data-theme="light|dark"] { color-scheme: light|dark; }
     makes light-dark() work correctly with the toggle

   BUT: @media (prefers-color-scheme: dark) checks SYSTEM preference,
   NOT the data-theme attribute! So font-weight rules inside the media
   query would apply based on system setting, ignoring user's toggle.

   SOLUTION:
   1. Base rules set light mode font-weight (450)
   2. Media query rules use html:not([data-theme="light"]) to skip when
      user explicitly chose light mode despite dark system
   3. Explicit html[data-theme="dark"] rules handle user toggling to dark
      when their system is in light mode
   ========================================================================== */

/* Base font-weight: light mode default (400) */
.essay-body p,
.essay-body li,
.note-body p,
.note-body li,
.page-body p,
.page-body li,
.latest-essay p {
    font-weight: var(--font-weight-normal);
}

/* Dark Mode (System Preference) - Applies when SYSTEM prefers dark
   AND user hasn't explicitly toggled to light mode
   -------------------------------------------------- */

@media (prefers-color-scheme: dark) {
    /* Typography - Enhanced heading contrast in dark mode */
    h2 { color: var(--text-heading-h2); }
    h3 { color: var(--text-heading-h3); }
    h4 { color: var(--text-heading-h4); }
    h5, h6 { color: var(--text-heading-h5); }

    /* Headings - maintain weight hierarchy in dark mode */
    h1,
    .page-title,
    h2, h3, h4, h5, h6,
    .essay-title-single,
    .note-title-single {
        font-weight: var(--font-weight-semibold);
    }

    /* Body text - lighter weight in dark mode (only when user hasn't chosen light) */
    html:not([data-theme="light"]) p,
    html:not([data-theme="light"]) li {
        font-weight: var(--font-weight-normal);
    }

    /* Episode tag - lighter weight in dark mode */
    .episode-tag {
        font-weight: var(--font-weight-light);
    }

    /* List titles - lighter weight in dark mode (only when user hasn't chosen light) */
    html:not([data-theme="light"]) .essay-title,
    html:not([data-theme="light"]) .note-title {
        font-weight: var(--font-weight-light);
    }

    /* Long-form reading - only when user hasn't explicitly chosen light mode */
    html:not([data-theme="light"]) .essay-body p,
    html:not([data-theme="light"]) .essay-body li,
    html:not([data-theme="light"]) .note-body p,
    html:not([data-theme="light"]) .note-body li,
    html:not([data-theme="light"]) .page-body p,
    html:not([data-theme="light"]) .page-body li,
    html:not([data-theme="light"]) .latest-essay p {
        font-weight: var(--font-weight-light);
    }

    /* Bold text - semibold for emphasis, size/context separates from headings */
    .essay-body strong,
    .essay-body b,
    .note-body strong,
    .note-body b,
    .page-body strong,
    .page-body b {
        font-weight: var(--font-weight-semibold);
    }

    /* Syntax Highlighting - Code blocks */
    .essay-body .highlight pre,
    .note-body .highlight pre {
        background: var(--code-background) !important;
        border-color: var(--border-color);
    }

    .essay-body .highlight pre[style],
    .note-body .highlight pre[style] {
        background: var(--code-background) !important;
        color: #d0d0d0 !important;
    }
}

/* Dark Mode (Explicit Toggle) - User toggled to dark mode regardless of system
   Needed when system is light but user wants dark mode
   -------------------------------------------------- */

html[data-theme="dark"] p,
html[data-theme="dark"] li {
    font-weight: var(--font-weight-normal);
}

html[data-theme="dark"] .essay-body p,
html[data-theme="dark"] .essay-body li,
html[data-theme="dark"] .note-body p,
html[data-theme="dark"] .note-body li,
html[data-theme="dark"] .page-body p,
html[data-theme="dark"] .page-body li,
html[data-theme="dark"] .latest-essay p {
    font-weight: var(--font-weight-light);
}

html[data-theme="dark"] .essay-title,
html[data-theme="dark"] .note-title {
    font-weight: var(--font-weight-light);
}


/* ==========================================================================
   15. PRINT - Print Stylesheet

   Minimal print styles: hide chrome, clean typography.
   ========================================================================== */

@media print {
    body::before, nav, footer, .podcast, .topic-tags {
        display: none;
    }
    body { background: white; color: black; }
    a { color: black; text-decoration: underline; }
}

/* ==========================================================================
   16. MEDIA EMBEDS - YouTube, Video Captions

   Responsive video embeds (16:9 aspect ratio) and privacy-respecting
   preview thumbnails with play button overlay.
   ========================================================================== */

/* Add extra spacing after "Recent speaking" heading */
#recent-speaking {
    margin-bottom: var(--space-lg);
}

/* Add spacing after YouTube embeds (both standard and preview versions) */
div[style*="padding-bottom: 56.25%"],
.youtube-preview-container {
    margin-bottom: var(--space-xl);
}

/* YouTube preview shortcode styles */
.youtube-preview-container {
    position: relative;
    padding-bottom: 56.25%;  /* 16:9 aspect ratio */
    height: 0;
    overflow: hidden;
    cursor: pointer;

    img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: 0;
    }
}

.play-button-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80px;
    height: 80px;
    background: rgba(255, 0, 0, 0.9);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;

    svg {
        margin-left: var(--icon-optical-adjust);
    }
}

/* Style paragraphs that follow YouTube embeds as captions */
div[style*="padding-bottom: 56.25%"] + p,
.youtube-preview-container + p {
    font-size: var(--font-sm);
    color: var(--text-secondary);
    margin-top: calc(var(--space-xl) * -0.5);  /* Pull caption closer to video */
    margin-bottom: var(--space-xl);
}

/* Strong text within captions (event/panel titles) */
div[style*="padding-bottom: 56.25%"] + p strong,
.youtube-preview-container + p strong {
    font-weight: var(--font-weight-semibold);
    font-style: normal;
    color: var(--text-primary);
}

/* ==========================================================================
   17. MOBILE - Responsive Breakpoints

   Mobile-first adjustments for screens < 600px.
   Note: Breakpoint is hardcoded because CSS variables don't work in media queries.
   ========================================================================== */

@media (max-width: 600px) {
    html { font-size: 16px; }

    .container { padding: var(--space-lg) var(--container-mobile-h-padding) 0 var(--container-mobile-h-padding); }
    /* Keep header row layout, just tighten nav gap */
    nav { gap: var(--space-md); }
    .email-form input[type="email"] { max-width: none; }
    .footer-links a[aria-label="Value for value"]::after {
        content: "";
        position: absolute;
        inset: -16px -18px;
    }
    .podcast-header { flex-direction: column; align-items: flex-start; }
    .podcast-art { width: 130px; height: 130px; }
    .podcast-links { margin-top: 0; }
    .pagination { flex-direction: column; align-items: flex-start; }
    .info-pair code {
        white-space: pre-line;     /* Preserve newlines, wrap at spaces (fingerprints) */
        overflow-wrap: break-word; /* Break long words if needed (npubs, keys) */
    }
}

/* ==========================================================================
   18. V4V PAGE - Value for Value Payment Page

   Bitcoin Lightning payment page with amount selection, QR generation,
   and payment status tracking.
   ========================================================================== */

.v4v-page {
    max-width: var(--content-max-width);
    margin: 0 auto;
}

.v4v-content {
    margin-top: var(--space-md);
}

.v4v-intro {
    font-size: var(--font-lg);
    color: var(--text-secondary);
    margin-bottom: var(--space-xl);
    line-height: var(--line-height-body);
}

#share-essay {
    color: var(--brand-orange);
    text-decoration: none;
    cursor: pointer;
}

#share-essay:hover {
    text-decoration: underline;
}

.amount-selection {
    margin-bottom: var(--space-md);
}

.amount-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-md);
    margin-bottom: var(--space-md);
}

.amount-btn {
    padding: var(--space-lg);
    background: transparent;
    border: var(--border-width-emphasis) solid var(--border-color);
    border-radius: var(--border-radius-interactive);
    cursor: pointer;
    font-family: var(--font-system);
    font-size: var(--font-xl);
    font-weight: var(--font-weight-semibold);
    font-variant-numeric: tabular-nums;
    color: var(--text-primary);
    transition: all var(--transition-fast);
}

.amount-btn:hover {
    border-color: var(--brand-orange);
    color: var(--brand-orange);
}

.amount-btn:active {
    transform: translateY(1px);
}

.amount-btn--suggested {
    border-color: var(--brand-orange);
    color: var(--brand-orange);
}

.amount-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.amount-btn:disabled:hover {
    border-color: var(--border-color);
    color: var(--text-primary);
}

.amount-btn--suggested:disabled {
    border-color: var(--brand-orange);
    color: var(--brand-orange);
}

.custom-amount-label {
    display: block;
    font-size: var(--font-sm);
    color: var(--text-meta);
    margin-bottom: var(--space-sm);
    font-weight: var(--font-weight-normal);
}

.custom-amount-field {
    display: flex;
    gap: var(--space-sm);
    align-items: stretch;
}

.custom-amount-input {
    padding: var(--space-xs) 0;
    border: none;
    border-bottom: var(--border-width) solid var(--border-color);
    border-radius: 0;
    font-family: var(--font-system);
    font-size: var(--font-base);
    background: var(--background-body);
    color: var(--text-primary);
    width: calc((100% - 3 * var(--space-sm)) / 4);
    text-align: right;
    transition: border-color var(--transition-fast);
}

.custom-amount-input:focus {
    outline: none;
    border-bottom-color: var(--brand-orange);
}

.custom-amount-input::placeholder {
    color: var(--text-meta);
    opacity: 0.5;
}

.custom-amount-btn {
    padding: var(--space-sm) var(--space-md);
    background: transparent;
    color: var(--text-meta);
    border: var(--border-width) solid var(--text-meta);
    border-radius: var(--border-radius-interactive);
    font-family: var(--font-system);
    font-size: var(--font-sm);
    font-weight: var(--font-weight-medium);
    cursor: pointer;
    transition: all var(--transition-fast);
    white-space: nowrap;
    flex-shrink: 0;
}

.custom-amount-btn:hover {
    border-color: var(--brand-orange);
    color: var(--brand-orange);
}

.custom-amount-btn:active {
    transform: translateY(1px);
}

.custom-amount-input:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.custom-amount-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.custom-amount-btn:disabled:hover {
    border-color: var(--text-meta);
    color: var(--text-meta);
}

.validation-error {
    color: var(--brand-orange);
    font-size: var(--font-sm);
    margin-top: var(--space-sm);
    margin-bottom: 0;
}

.error-display {
    text-align: center;
    padding: var(--space-xl);
    background: var(--background-card);
    border-radius: var(--border-radius-md);
    margin-bottom: var(--space-lg);
    animation: v4v-fadeIn var(--transition-base) ease-out;
}

.error-display .error-message {
    color: var(--brand-orange);
    font-size: var(--font-base);
    margin-bottom: var(--space-lg);
}

.error-dismiss-btn {
    background: none;
    border: var(--border-width) solid var(--text-meta);
    border-radius: var(--border-radius-interactive);
    color: var(--text-meta);
    cursor: pointer;
    font-family: var(--font-system);
    font-size: var(--font-sm);
    font-weight: var(--font-weight-medium);
    padding: var(--space-xs) var(--space-md);
    transition: all var(--transition-fast);
}

.error-dismiss-btn:hover {
    border-color: var(--brand-orange);
    color: var(--brand-orange);
}

.qr-display {
    text-align: center;
    padding: var(--space-xl);
    background: var(--background-card);
    border-radius: var(--border-radius-md);
    margin-bottom: var(--space-lg);
    transition: background-color var(--transition-fast);
    animation: v4v-fadeIn var(--transition-base) ease-out;
}

@keyframes v4v-fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.qr-code {
    min-height: var(--qr-size);
    display: flex;
    align-items: center;
    justify-content: center;
}

.qr-code:has(canvas) {
    margin-top: var(--space-sm);
    margin-bottom: var(--space-lg);
}

.qr-loading {
    color: var(--text-meta);
    font-size: var(--font-base);
    margin: 0;
    text-decoration: none;
}

.qr-loading.polling {
    animation: v4v-pulse 2s ease-in-out infinite;
}

@keyframes v4v-pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.polling-status {
    font-size: var(--font-sm);
    color: var(--text-meta);
    margin-bottom: var(--space-md);
    animation: v4v-pulse 2s ease-in-out infinite;
}

.qr-code canvas {
    display: block;
    margin: 0 auto;
    box-shadow: var(--shadow-content-light);
    transition: box-shadow var(--transition-fast);
}

a.qr-link,
a.qr-link:hover {
    display: block;
    cursor: pointer;
    text-decoration: none;
}

.qr-link:hover .qr-code canvas {
    box-shadow: 0 0 0 3px var(--brand-orange);
}

.qr-hint {
    font-size: var(--font-sm);
    color: var(--text-meta);
    margin-bottom: var(--space-md);
}

.qr-hint--mobile {
    display: inline;
}

.qr-hint--desktop {
    display: none;
}

@media (min-width: 768px) {
    .qr-hint--mobile {
        display: none;
    }
    .qr-hint--desktop {
        display: inline;
    }
}

.qr-amount {
    font-size: var(--font-2xl);
    font-weight: var(--font-weight-bold);
    color: var(--text-primary);
    margin-bottom: var(--space-xs);
    letter-spacing: var(--letter-spacing-tight-md);
}

.qr-amount-value {
    font-variant-numeric: tabular-nums;
}

.qr-copy-link {
    background: none;
    border: none;
    color: var(--text-meta);
    cursor: pointer;
    font-family: inherit;
    font-size: inherit;
    font-weight: var(--font-weight-normal);
    text-decoration: underline;
    padding: 0;
    transition: color var(--transition-fast);
}

.qr-copy-link:hover {
    color: var(--brand-orange);
}

.qr-cancel-btn {
    background: none;
    border: var(--border-width) solid var(--text-meta);
    border-radius: var(--border-radius-interactive);
    color: var(--text-meta);
    cursor: pointer;
    font-family: var(--font-system);
    font-size: var(--font-sm);
    font-weight: var(--font-weight-medium);
    text-decoration: none;
    padding: var(--space-xs) var(--space-md);
    transition: all var(--transition-fast);
}

.qr-cancel-btn:hover {
    border-color: var(--brand-orange);
    color: var(--brand-orange);
}

.payment-status {
    text-align: center;
    padding: var(--space-2xl);
    background: var(--background-card);
    margin-bottom: var(--space-xl);
    transition: background-color var(--transition-fast);
}

.payment-check {
    font-size: var(--font-2xl);
    font-weight: var(--font-weight-semibold);
    color: var(--brand-orange);
    margin-bottom: var(--space-sm);
    letter-spacing: var(--letter-spacing-tight-md);
}

.payment-thanks {
    color: var(--text-secondary);
    font-size: var(--font-base);
    margin-bottom: 0;
}

.v4v-page .essay-nav {
    margin-top: 0;  /* amount-selection margin-bottom provides spacing */
}

.v4v-details {
    margin-top: var(--space-lg);
}

.v4v-details summary {
    cursor: pointer;
    font-size: var(--font-base);
    color: var(--text-meta);
    font-weight: var(--font-weight-medium);
    transition: color var(--transition-fast);
    list-style-position: outside;
    list-style: none;
}

.v4v-details summary::marker {
    display: none;
}

.v4v-details summary:hover {
    color: var(--brand-orange);
}

.v4v-details p {
    margin-top: var(--space-md);
    font-size: var(--font-base);
    color: var(--text-secondary);
    line-height: var(--line-height-body);
}

.v4v-details p:last-child {
    margin-bottom: 0;
}

/* V4V mobile adjustments */
@media (max-width: 600px) {
    .custom-amount-input {
        max-width: none;
    }

    .qr-display,
    .payment-status {
        padding: var(--space-xl);
    }

    /* !important required to override inline styles from QR library */
    .qr-code canvas {
        width: var(--qr-size) !important;
        height: var(--qr-size) !important;
    }
}
