/* ==========================================================================
   Main Stylesheet for Tangerine Theme
   Shared design system for Hugo sites
   ========================================================================== */

/* ==========================================================================
   Web Font Loading

   Strategy: font-display: optional for fastest perceived load
   - If Satoshi loads quickly (within 100ms block period): use it
   - If Satoshi is delayed: use fallback system font, don't swap later
   - Prevents layout shift and "flash of web font" (FOUT)
   - System fallback: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto

   Font file: 43KB Satoshi variable (weights 300-900)
   ========================================================================== */

@font-face {
    font-family: 'Satoshi';
    font-weight: 300 900;
    font-style: normal;
    font-display: optional;
    src: url('/fonts/Satoshi-Variable.woff2') format('woff2-variations');
}

/* ==========================================================================
   CSS Custom Properties (Design Tokens)
   ========================================================================== */

:root {
    /* Color Scheme - Signals browser to adapt UI elements (scrollbars, form controls) */
    color-scheme: dark light;

    /* Brand Colors - Trust Revolution Orange
       Visual brand: #F84200 (used in brand bar, podcast art)
       Text implementation: #d63900 light / #FF5733 dark (WCAG AA compliant) */
    --brand-orange: light-dark(#d63900, #FF5733);
    --brand-orange-hover: light-dark(#bf3300, #FF6B47);

    /* Text Colors - WCAG AA compliant */
    --text-primary: light-dark(#1a1a1a, #f0f0f0);
    --text-secondary: light-dark(#444, #c8c8c8);
    --text-meta: light-dark(#666, #a8a8a8);
    --text-subtle: light-dark(#767676, #b0b0b0);
    --text-bold: light-dark(#1a1a1a, #ffffff);
    --text-on-brand: #1a1a1a;  /* Dark text for brand-color backgrounds (skip-link, buttons on orange) */
    --highlight-bg: light-dark(#fef3cd, #443818);  /* soft yellow / amber */
    --border-color: light-dark(#d5d5d5, #505050);
    --background-body: light-dark(#ffffff, #1e1e1e);
    --background-card: light-dark(#f5f5f5, #2a2a2a);

    /* Typography */
    --font-system: 'Satoshi', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    --font-monospace: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
    --line-height-body: 1.5;
    --line-height-title: 1.15;  /* Tight line-height for large display titles */

    /* Font Weights */
    --font-weight-light: 300;     /* Lighter weight for dark mode */
    --font-weight-normal: 400;
    --font-weight-body: 450;      /* Body text - heavier than normal for Inter */
    --font-weight-medium: 500;
    --font-weight-semibold: 600;
    --font-weight-bold: 700;

    /* Letter Spacing */
    --letter-spacing-tight-xl: -0.03em;
    --letter-spacing-tight-lg: -0.025em;
    --letter-spacing-tight-md: -0.02em;
    --letter-spacing-tight-sm: -0.015em;
    --letter-spacing-normal: normal;
    --letter-spacing-wide: 0.05em;
    --letter-spacing-body: -0.01em;

    /* =======================================================================
       VERTICAL RHYTHM SYSTEM

       Base unit: 8px grid
       Philosophy: Balanced hierarchy without excessive whitespace
       Design goal: Content > structure. Clear visual hierarchy that serves
                    readability without feeling cramped or airy.

       TOKEN HIERARCHY (Semantic Meaning):
       --space-xs (8px):   Tight grouping within elements
       --space-sm (12px):  Related elements (CTAs, internal spacing)
       --space-md (16px):  Default spacing (paragraphs, list items, small headings)
       --space-lg (24px):  Section internal spacing (meta groups, subsection headers)
       --space-xl (32px):  Section breaks (page titles, content footers, back links)
       --space-2xl (48px): Major separations (header→main, main→footer, homepage sections)
       --space-3xl (64px): Page header element stacks (meta+title+first heading)

       USAGE RULES:
       1. Header-to-main gap: Always 2xl (48px) via header margin-bottom
       2. Main-to-footer gap: Always 2xl (48px) via footer margin-top
       3. Sections use margin-bottom: 0 (footer controls final gap)
       4. Content headings: H2 (xl/32px top), H3 (lg/24px top), H4 (md/16px top)
       5. First heading after page header: margin-top: 0 (header provides spacing)
       6. Never stack margins - one element controls the gap
       ======================================================================= */

    /* Spacing Tokens */
    --space-label-gap: 0.25rem;  /* 4px - Label-to-value gap in info pairs */
    --arrow-gap: 0.125rem;       /* 2px - Arrow spacing in links */
    --space-xs: 0.5rem;          /* 8px - Tight grouping within elements */
    --space-sm: 0.75rem;         /* 12px - Related elements (CTAs, internal spacing) */
    --space-md: 1rem;            /* 16px - Default spacing (paragraphs, list items, small headings) */
    --space-lg: 1.5rem;          /* 24px - Section internal spacing (meta groups, subsection headers) */
    --space-xl: 2rem;            /* 32px - Section breaks (page titles, content footers, back links) */
    --space-2xl: 3rem;           /* 48px - Major separations (header→main, main→footer, homepage sections) */
    --space-3xl: 4rem;           /* 64px - Page header element stacks (meta+title+first heading sequences) */

    /* Component Sizing */
    --content-max-width: 700px;
    --card-padding: 2rem;
    --border-radius-interactive: 4px;
    --border-radius-code: 4px;
    --brand-bar-height: 3px;
    --checkbox-size: 1.1em;
    --qr-size: 250px;
    --table-cell-padding: 0.75rem 1rem;

    /* Z-index Scale */
    --z-brand-bar: 9999;
    --z-skip-link: 10000;

    /* Opacity */
    --opacity-subdued: 0.5;

    /* Transitions */
    --transition-fast: 0.3s ease;

    /* Link Styling */
    --underline-offset: 0.2em;
    --underline-thickness: 1px;
    --underline-opacity: 50%;

    /* Content Elevation */
    --shadow-content-light: light-dark(0 1px 3px rgba(0, 0, 0, 0.15), 0 2px 4px rgba(0, 0, 0, 0.4));

    /* Syntax Highlighting */
    --syntax-keyword: light-dark(#0066aa, #6cb6ff);
    --syntax-function: light-dark(#6f42c1, #d2a8ff);
    --syntax-string: light-dark(#aa5d00, #e9b872);
    --syntax-operator: light-dark(#555555, #b0b0b0);
    --syntax-default: light-dark(#1a1a1a, #d0d0d0);

    /* Typography - Heading colors (enhanced contrast in dark mode) */
    --text-heading-h2: light-dark(#1a1a1a, #ffffff);
    --text-heading-h3: light-dark(#1a1a1a, #ebebeb);
    --text-heading-h4: light-dark(#1a1a1a, #e0e0e0);
    --text-heading-h5: light-dark(#1a1a1a, #d8d8d8);
    --code-background: light-dark(#f5f5f5, #1e1e1e);

    /* Typography Scale (Perfect Fourth: 1.333) */
    --font-xs: 0.75rem;
    --font-sm: 0.875rem;
    --font-code: 0.9rem;          /* Monospace code */
    --font-base: 1rem;
    --font-lg: 1.125rem;
    --font-lg-plus: 1.0625rem;    /* Bio/intro text (17px) */
    --font-xl: 1.333rem;
    --font-2xl: 1.777rem;
    --font-3xl: 2.369rem;
    --font-4xl: 3.157rem;

    /* Custom Typography Sizes */
    --font-custom-32: 2rem;
    --font-custom-24: 1.5rem;

    /* Border Width */
    --border-width: 1px;
    --border-width-accent: 4px;
    --border-width-emphasis: 2px;
    --border-height-thin: 1px;

    /* Content Element Sizing */
    --podcast-art-size: 150px;
    --button-min-width-lg: 85px;
    --skip-link-max-width: 260px;
    --image-size-lg: 200px;
}

/* Manual Theme Override - User can force light or dark mode via 'd' keyboard toggle
   The light-dark() function automatically selects values based on color-scheme */
html[data-theme="light"] { color-scheme: light; }
html[data-theme="dark"] { color-scheme: dark; }

/* ==========================================================================
   Base Styles & Resets
   ========================================================================== */

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html {
    font-size: 106.25%; /* 17px base - Satoshi has smaller x-height than Inter */
    overflow-y: scroll; /* Prevent horizontal shift when scrollbar appears/disappears */
}

body {
    font-family: var(--font-system);
    line-height: var(--line-height-body);
    color: var(--text-primary);
    background: var(--background-body);
    font-size: 17px;
    transition: background-color 0.3s ease, color 0.3s ease;
    letter-spacing: var(--letter-spacing-body);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

code,
pre,
.info-pair code {
    letter-spacing: normal;
}

.info-pair code {
    display: inline-block;
    max-width: 100%;
    white-space: pre-line;
}

/* ==========================================================================
   Brand Bar (Fixed Top)
   ========================================================================== */

body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: var(--brand-bar-height);
    background: var(--brand-orange);
    z-index: var(--z-brand-bar);
}

/* ==========================================================================
   Typography
   ========================================================================== */

/*
 * Heading Letter-Spacing Strategy:
 * - Base: All headings use tight-md (-0.01em) for comfortable reading
 * - H1: Override to tight-lg (-0.02em) because larger text needs tighter spacing
 * - .site-title: Override to normal (0) for brand name readability
 */
h1, h2, h3, h4, h5, h6 {
    letter-spacing: var(--letter-spacing-tight-md);
    color: var(--text-primary);
}

h1 {
    font-size: var(--font-custom-32);
    font-weight: var(--font-weight-medium);
    margin-bottom: var(--space-xl);
    letter-spacing: var(--letter-spacing-tight-lg);
}

/* Homepage display title - large, prominent headline */
h1.display-title {
    font-size: var(--font-2xl);
    font-weight: var(--font-weight-medium);
    line-height: var(--line-height-title);
    margin-top: 0;
    margin-bottom: var(--space-md);
    letter-spacing: var(--letter-spacing-tight-lg);
}

/* Home link square - 24x24px solid orange square */
.home-link {
    display: flex;
    align-items: center;
}

.home-square {
    display: block;
    width: 24px;
    height: 24px;
    background-color: var(--brand-orange);
}

.home-link:hover .home-square {
    opacity: 0.8;
}


/* Global headings */
h2 {
    font-size: var(--font-custom-24);
    font-weight: var(--font-weight-semibold);
    margin-top: var(--space-xl);  /* 32px */
    margin-bottom: var(--space-md);
}

h3 {
    font-size: var(--font-lg);
    font-weight: var(--font-weight-semibold);
    margin-top: var(--space-lg);
    margin-bottom: var(--space-sm);
}

h4 {
    font-size: var(--font-lg);
    font-weight: var(--font-weight-semibold);
    margin-top: var(--space-lg);
    margin-bottom: var(--space-xs);
}

h5, h6 {
    font-size: var(--font-base);
    font-weight: var(--font-weight-semibold);
    margin-top: var(--space-lg);
    margin-bottom: var(--space-xs);
}

/* Reduce heading spacing when preceded by CTA links (compensate for no margin collapse) */
.cta-link + h2,
.download-link + h2 {
    margin-top: var(--space-sm);
}

.cta-link + h3,
.download-link + h3 {
    margin-top: var(--space-sm);
}

.podcast-content h3 {
    margin-top: var(--space-2xl);
}

p {
    margin-bottom: var(--space-md);
    color: var(--text-secondary);
    font-weight: var(--font-weight-body);
}

/* Reduce gap before action links */
p:has(+ .cta-link),
p:has(+ .download-link),
p:has(+ .back-link) {
    margin-bottom: var(--space-sm);
}

ul {
    margin: var(--space-md) 0;
    padding-left: var(--space-lg);
}

li {
    margin-bottom: var(--space-xs);
    line-height: var(--line-height-body);
    color: var(--text-secondary);
    font-weight: var(--font-weight-body);
}

/* Bold text in page-body content - enhanced visibility */
.page-body strong,
.page-body b {
    font-weight: var(--font-weight-semibold);
    color: var(--text-bold);
}

/* Highlighted text (markdown ==text==) */
mark {
    background-color: var(--highlight-bg);
    color: var(--text-primary);
    padding: 0.2em 0.4em;
    border-radius: var(--border-radius-code);
}

/* ==========================================================================
   Links
   ========================================================================== */

a {
    color: var(--brand-orange);
    text-decoration: none;
    transition: color var(--transition-fast);
}

a:hover {
    color: var(--brand-orange-hover);
    text-decoration: underline;
    text-decoration-color: color-mix(in srgb, var(--brand-orange-hover) var(--underline-opacity), transparent);
    text-decoration-thickness: var(--underline-thickness);
    text-underline-offset: var(--underline-offset);
}

/* Navigation links - no underline on hover (clear navigation zones) */
header a:hover,
.footer-links a:hover,
.skip-link:hover {
    text-decoration: none;
}

/* Arrow alignment in links */
a span[aria-hidden="true"] {
    display: inline-block;
    vertical-align: middle;
    transform: translateY(-0.1em);
    text-decoration: none;
    font-size: 0.85em;
    opacity: 0.7;
}

/* ==========================================================================
   Focus Indicators - Keyboard Navigation Accessibility
   ========================================================================== */

/* Remove default outline, replace with custom focus-visible styles */
a:focus {
    outline: none;
}

/* Visible focus indicators for keyboard navigation only */
a:focus-visible,
button:focus-visible,
input:focus-visible,
textarea:focus-visible,
select:focus-visible,
[tabindex]:focus-visible {
    outline: 2px solid var(--brand-orange);
    outline-offset: 2px;
    border-radius: 2px;
}

/* Skip link maintains its existing transform behavior */
.skip-link:focus-visible {
    outline: 2px solid var(--brand-orange);
    outline-offset: 2px;
}

/* Email form input focus - enhance existing focus state */
.email-form input[type="email"]:focus-visible {
    outline: 2px solid var(--brand-orange);
    outline-offset: 2px;
}

/* ==========================================================================
   Reduced Motion Support
   ========================================================================== */

@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }

    /* Skip link should still appear for accessibility */
    .skip-link:focus {
        transition: none;
    }
}

/* ==========================================================================
   Link Hierarchy System
   1. PRIMARY CTAs: Orange with arrows, color only on hover (.cta-link)
   2. SECONDARY LINKS: Gray, underline at rest, none on hover (.download-link)
   3. CONTACT/INLINE LINKS: Orange, underline on hover (.info-value, inline content links)
   ========================================================================== */

/* ==========================================================================
   Link Hierarchy - Consolidated Transition
   ========================================================================== */

/* All brand-colored links share transition for consistent hover behavior */
.cta-link,
.all-essays,
.all-notes,
.podcast-links a,
.essay-footer a,
.pagination-prev,
.pagination-next,
.download-link,
.link-grid a {
    text-decoration: none;
    transition: color var(--transition-fast);
}

/* CTA Links - Primary action links WITH arrows (→)
   Usage: "Read more →", "All essays →", "Subscribe to newsletter →" */
.cta-link,
.all-essays,
.all-notes,
.podcast-links a,
.essay-footer a,
.pagination-prev,
.pagination-next {
    color: var(--brand-orange);
    font-weight: var(--font-weight-medium);
    display: inline-flex;
    align-items: center;
    gap: var(--arrow-gap);
}

/* Action links: consistent margins (content controls gap via :has() rules) */
.cta-link {
    margin-bottom: 0;
}

/* CTAs inside paragraphs: inline, no wrapping */
p .cta-link {
    white-space: nowrap;
}

/* Hover state for all primary CTAs - no underline (arrows would be underlined) */
.cta-link:hover,
.all-essays:hover,
.all-notes:hover,
.podcast-links a:hover,
.essay-footer a:hover,
.pagination-prev:hover,
.pagination-next:hover {
    color: var(--brand-orange-hover);
    text-decoration: none;
}

/* Underline link text (not arrow) on hover */
.cta-link:hover .link-text,
.all-essays:hover .link-text,
.all-notes:hover .link-text,
.podcast-links a:hover .link-text,
.essay-footer a:hover .link-text,
.pagination-prev:hover .link-text,
.pagination-next:hover .link-text {
    text-decoration: underline;
    text-decoration-color: color-mix(in srgb, var(--brand-orange-hover) var(--underline-opacity), transparent);
    text-decoration-thickness: var(--underline-thickness);
    text-underline-offset: var(--underline-offset);
}

/* Download Links - Secondary utility style for downloads
   Usage: "Download contact card", "Download ASCII key"
   Gray, underlined, less prominent than CTAs */
.download-link {
    color: var(--text-meta);
    font-size: var(--font-base);
    font-weight: var(--font-weight-normal);
    text-decoration: underline;
    text-decoration-color: color-mix(in srgb, var(--text-meta) var(--underline-opacity), transparent);
    text-decoration-thickness: var(--underline-thickness);
    text-underline-offset: var(--underline-offset);
    transition: color var(--transition-fast);
    display: block;
    width: fit-content;
    margin-top: var(--space-sm);
}

/* Stacked action links: peers get equal spacing */
.cta-link + .cta-link,
.cta-link + .download-link,
.download-link + .cta-link,
.download-link + .download-link {
    margin-top: var(--space-lg);
}

/* Freestanding action links after info blocks: breathing room */
.info-pair:has(+ .cta-link),
.info-pair:has(+ .download-link) {
    margin-bottom: var(--space-lg);
}

/* New section after action links */
.cta-link + .info-pair,
.download-link + .info-pair {
    margin-top: var(--space-xl);
}

/* Contact section spacing from intro text */
.contact-section {
    margin-top: var(--space-lg);
}

/* Service Links - Orange, no arrows
   Usage: Podcast platforms, social links */
.link-grid a {
    color: var(--brand-orange);
    font-weight: var(--font-weight-medium);
    font-size: var(--font-base);
}

/* Hover states */
.download-link:hover {
    color: var(--brand-orange-hover);
    text-decoration: none;
}

.link-grid a:hover {
    color: var(--brand-orange-hover);
    text-decoration: underline;
    text-decoration-color: color-mix(in srgb, var(--brand-orange-hover) var(--underline-opacity), transparent);
    text-decoration-thickness: var(--underline-thickness);
    text-underline-offset: var(--underline-offset);
}

/* ==========================================================================
   Layout Container
   ========================================================================== */

.container {
    max-width: var(--content-max-width);
    margin: 0 auto;
    padding: var(--space-xl) var(--space-md) 0 var(--space-md);
}

/* ==========================================================================
   Header & Navigation
   ========================================================================== */

body > .container:first-of-type {
    padding-bottom: 0;
}

/* ==========================================================================
   Header/Footer Spacing Tokens

   Footer tight gap uses explicit padding because line-height extends ABOVE
   text, not between the HR and content.
   ========================================================================== */
:root {
    --section-gap: var(--space-2xl);          /* 48px - Interior section breaks */
    --header-gap-below: var(--space-xl);      /* 32px - Frame edge: header to content */
    --footer-gap-above: var(--space-xl);      /* 32px - Frame edge: content to footer HR */
    --footer-gap-tight: var(--space-sm);      /* 12px - Tight coupling: HR to footer content */
    --footer-gap-below: var(--space-xl);      /* 32px - Space between footer content and page bottom */
}

/* Page-level site header spacing (not article headers) */
body > .container > header {
    display: flex;
    justify-content: space-between;
    align-items: last baseline;
    margin-bottom: var(--header-gap-below);
}

.site-title {
    margin: 0;
    font-size: var(--font-lg);
    font-weight: var(--font-weight-semibold);
}

.site-title a {
    color: var(--text-primary);
    text-decoration: none;
}

.site-title a:hover {
    color: var(--brand-orange);
}

nav {
    display: flex;
    gap: var(--space-lg);
    margin-bottom: 0;
}

main .container {
    padding-top: 0;
}

nav a {
    color: var(--text-secondary);
    font-weight: var(--font-weight-medium);
    text-decoration: none;

    &:hover,
    &.active {
        color: var(--brand-orange);
    }
}

/* ==========================================================================
   Homepage Sections
   ========================================================================== */

.latest-essay,
.latest-essay + h2.essay-section-header,
.recent-essays {
    margin-top: var(--section-gap);
}

/* ==========================================================================
   Site Footer (Unified Footer Zone)
   ========================================================================== */

body > .container > footer {
    margin-top: var(--footer-gap-above);
    padding-top: var(--footer-gap-tight);
    padding-bottom: var(--footer-gap-below);
    border-top: var(--border-width) solid color-mix(in srgb, var(--border-color) 50%, transparent);
}

.email-signup-intro {
    color: var(--text-secondary);
    font-size: var(--font-base);
    line-height: var(--line-height-body);
    margin-bottom: var(--space-sm);
}

.email-form {
    display: flex;
    gap: var(--space-xs);
    align-items: stretch;
    margin-bottom: var(--space-lg);  /* Internal zone spacing to footer links */
    flex-wrap: nowrap;
}

.email-form input[type="email"] {
    padding: 0.4rem 0;
    border: none;
    border-bottom: var(--border-width) solid color-mix(in srgb, var(--border-color) 50%, transparent);
    border-radius: 0;
    font-size: var(--font-sm);
    font-family: var(--font-system);
    background: var(--background-body);
    color: var(--text-primary);
    flex: 1;
    max-width: var(--skip-link-max-width);
    transition: border-color var(--transition-fast);
}

.email-form input[type="email"]:focus {
    outline: none;
    border-bottom-color: var(--brand-orange);
}

/* Show validation hint only after user has typed something */
.email-form input[type="email"]:invalid:not(:placeholder-shown) {
    border-bottom-color: var(--brand-orange);
}

.email-form input[type="email"]::placeholder {
    color: var(--text-meta);
    opacity: 0.5;
}

.email-form button {
    padding: 0.5rem 1rem;
    background: transparent;
    color: var(--text-meta);
    border: var(--border-width) solid var(--text-meta);
    border-radius: var(--border-radius-interactive);
    font-size: var(--font-xs);
    font-weight: var(--font-weight-medium);
    font-family: inherit;
    cursor: pointer;
    transition: all var(--transition-fast);
    white-space: nowrap;
    flex-shrink: 0;
}

.email-form button:hover {
    border-color: var(--brand-orange);
    color: var(--brand-orange);
}

.footer-links {
    display: flex;
    gap: var(--space-md);
    flex-wrap: wrap;
    align-items: center;
}

.footer-links a {
    color: var(--text-meta);
    text-decoration: none;
    transition: color var(--transition-fast);
    font-size: var(--font-sm);
    display: inline-flex;
    align-items: center;
    gap: var(--arrow-gap);

    &:hover {
        color: var(--brand-orange-hover);
    }
}

/* V4V icon tap target - pseudo-element creates 48x48 clickable area without affecting layout */
.footer-links a[aria-label="Value for value"] {
    position: relative;
}

/* Optical alignment - nudge SVG up to align with text x-height */
.footer-links a[aria-label="Value for value"] svg {
    vertical-align: middle;
}

.footer-links a[aria-label="Value for value"]::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 48px;
    height: 48px;
}

/* ==========================================================================
   Homepage Sections
   ========================================================================== */

.bio,
.notes-homepage-intro {
    margin-bottom: var(--space-xl);
    color: var(--text-secondary);
    font-size: var(--font-lg-plus);  /* 17px - slightly larger than base for prominence */
    line-height: var(--line-height-body);
}

.bio p,
.notes-homepage-intro p,
.page-body p {
    margin-bottom: var(--space-sm);
}

/* Reset CTA links inside intro sections to base size for consistency */
.bio .cta-link,
.notes-homepage-intro .cta-link {
    font-size: var(--font-base);
}

/* Override tight CTA spacing in bio - match paragraph spacing */
.bio p:has(+ .cta-link),
.notes-homepage-intro p:has(+ .cta-link) {
    margin-bottom: var(--space-sm);
}

/* Unified section header style */
.essay-section-header,
.section-label-small,
.topics h4 {
    font-size: var(--font-sm);
    font-weight: var(--font-weight-medium);
    letter-spacing: var(--letter-spacing-wide);
    text-transform: uppercase;
    color: var(--text-subtle);
    margin-bottom: var(--space-sm);  /* 24px - connects header to content */

    /* Override margin-top for semantic headings (h1/h2/h3) */
    &:is(h1, h2, h3) {
        margin-top: 0;
    }
}

/* Reduce spacing between section label and topic tags in topics section */
.topics .section-label-small {
    margin-bottom: var(--space-sm);  /* 12px - tighter grouping with topic tags */
}

.latest-essay {
    margin-bottom: var(--space-xl);

    /* Semantic heading: essay title (h3 under h2 section header) */
    h3 {
        font-size: var(--font-2xl);
        font-weight: var(--font-weight-semibold);
        margin-top: 0;
        margin-bottom: var(--space-sm);  /* 16px - title to description */
        line-height: 1.3;

        a {
            color: var(--text-primary);

            &:hover {
                color: var(--brand-orange);
            }
        }
    }

    p {
        margin-bottom: var(--space-sm);
        font-size: var(--font-base);
        line-height: var(--line-height-body);
    }
}

/* ==========================================================================
   Card Components - Base Styles
   ========================================================================== */

/* Base card styling shared by podcast, services, and RSS cards */
.podcast,
.link-grid-card,
.rss-feed-card {
    padding: var(--card-padding);
    background: var(--background-card);
    transition: background-color var(--transition-fast);
    contain: layout style paint; /* Isolate rendering for better performance */
}

.podcast {
    margin-bottom: var(--space-2xl);

    /* Prevent double spacing at card bottom edge */
    > *:last-child {
        margin-bottom: 0;
    }
}

/* Link grid and RSS cards share spacing */
.link-grid-card,
.rss-feed-card {
    margin-bottom: var(--space-xl);
}

/* RSS Feed Card - relative positioning for absolute copy button */
.rss-feed-card {
    position: relative;
}

.rss-url {
    font-family: var(--font-monospace);
    font-size: var(--font-code);
    color: var(--text-primary);
    display: block;
    padding-right: 4rem;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.rss-copy-btn {
    position: absolute;
    right: var(--space-lg);
    top: 50%;
    transform: translateY(-50%);
    background: transparent;
    color: var(--text-secondary);
    border: var(--border-width) solid var(--border-color);
    padding: 0.4rem 0.75rem;
    border-radius: var(--border-radius-interactive);
    cursor: pointer;
    font-weight: var(--font-weight-medium);
    font-size: var(--font-xs);
    transition: all var(--transition-fast);
    font-family: var(--font-system);
}

.rss-copy-btn:hover {
    border-color: var(--brand-orange);
    color: var(--brand-orange);
}

.podcast-header {
    display: flex;
    gap: var(--space-lg);
    align-items: center;
}

.podcast-info {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
}

/* Content images - systematic elevation */
.page-body img {
    box-shadow: var(--shadow-content-light);
    transition: box-shadow var(--transition-fast);
}

.podcast-art {
    width: var(--podcast-art-size);
    height: var(--podcast-art-size);
    flex-shrink: 0;
    display: block;
}

.podcast img {
    box-shadow: none;
    border: none;
    outline: none;
}

.episode-tag {
    display: block;
    font-size: var(--font-sm);
    font-weight: var(--font-weight-normal);
    letter-spacing: var(--letter-spacing-wide);
    color: var(--text-meta);
}

.episode-hook {
    font-size: var(--font-lg);
    font-weight: var(--font-weight-semibold);
    color: var(--text-primary);
}

.episode-guest {
    font-size: var(--font-base);
    font-weight: var(--font-weight-body);
    color: var(--text-primary);
}

.podcast-info .episode-info {
    display: flex;
    flex-direction: column;
}

.podcast-info .podcast-links {
    margin-top: var(--space-xs);
}

.podcast-info p {
    color: var(--text-secondary);
    font-size: var(--font-base);
}

.podcast-links {
    display: flex;
    gap: var(--space-md);
    align-items: center;
}

.episode-meta {
    display: block;
}

.episode-meta .episode-guest,
.episode-meta .separator,
.episode-meta .episode-tag {
    display: inline;
}

.separator {
    color: var(--text-meta);
    padding: 0 var(--space-xs);
}

.link-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-md);
}

.link-grid.single-column {
    grid-template-columns: 1fr;
}

/* ==========================================================================
   Topic Tags Section
   ========================================================================== */

.topics {
    margin-bottom: var(--space-md);  /* Tight coupling to essay list below */
}

/* When essays directly follow topics, remove essay list margin-top */
.topics + .recent-essays {
    margin-top: 0;
}

/* Keep section-label-medium different (year headers in notes) */
.recent-notes h3,
.section-label-medium {
    font-size: var(--font-base);
    font-weight: var(--font-weight-medium);
    letter-spacing: var(--letter-spacing-wide);
    text-transform: uppercase;
    color: var(--text-secondary);
    margin-bottom: var(--space-md);
    margin-top: var(--space-xl);
}

.recent-notes h3:first-child,
.section-label-medium:first-child {
    margin-top: 0;
}

.topic-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-sm);
    margin-bottom: 0;  /* Parent .topics controls spacing */

    a {
        color: var(--text-meta);
        text-decoration: none;
        font-size: var(--font-sm);

        &:hover {
            color: var(--brand-orange);
        }
    }
}

/* ==========================================================================
   Essay Listings
   ========================================================================== */

/* Section lists have no bottom margin - footer/next section provides spacing */
.recent-essays,
.recent-notes {
    margin-bottom: 0;
}

.page-title {
    font-size: var(--font-custom-32);
    font-weight: var(--font-weight-semibold);
    line-height: var(--line-height-title);
    margin-top: 0;
    margin-bottom: var(--space-xs);  /* Tight coupling to meta/subtitle; body controls gap via margin-top */
    letter-spacing: var(--letter-spacing-tight-xl);
}

.page-subtitle {
    font-size: var(--font-lg);
    color: var(--text-secondary);
    margin-top: 0;
    margin-bottom: var(--space-lg);
}

/* Content containers: margin-top collapses with meta/subtitle margin-bottom when present */
.page-body,
.podcast-content,
.topics {
    margin-top: var(--space-lg);
}

.essay-item,
.note-item {
    margin-bottom: var(--space-sm);
    contain: layout style paint; /* Isolate list items for better performance */

    a {
        color: var(--text-primary);
        text-decoration: none;
        display: flex;
        gap: var(--space-xs);
        line-height: 1.5;
        align-items: baseline;

        &:hover {
            color: var(--brand-orange);
        }
    }
}

time.essay-date,
time.note-date,
.essay-date,
.note-date {
    color: var(--text-meta);
    font-size: var(--font-sm);
    font-weight: var(--font-weight-normal);  /* Override body weight (450→400) */
    font-variant-numeric: tabular-nums;
    flex-shrink: 0;
    white-space: nowrap;
    min-width: var(--button-min-width-lg);
    letter-spacing: normal;  /* Override body tight spacing */
}

.essay-title,
.note-title-link {
    flex: 1;
    font-weight: var(--font-weight-medium);
    font-size: var(--font-base);
}


.all-essays,
.all-notes {
    margin-top: 0;  /* No extra gap - just uses last item's margin */
}

.topic-count {
    color: var(--text-secondary);
    font-size: var(--font-base);
    margin-bottom: var(--space-lg);  /* 24px - clear separation to essay list */
}

/* ==========================================================================
   Single Essay Page
   ========================================================================== */

.essay-content,
.note-content {
    max-width: var(--content-max-width);
}

.page-meta {
    margin-bottom: var(--space-lg);  /* Breathing room before content */
    color: var(--text-meta);
    font-size: var(--font-sm);
    display: flex;
    align-items: center;
    gap: var(--space-xs);
}

/* First heading in page-body needs reduced margin for tight title block */
.page-body > h2:first-child {
    margin-top: var(--space-sm);
}

.page-meta-separator {
    opacity: 0.5;
}

/* Essay/note titles - medium weight, size provides hierarchy */
.essay-title-single,
.note-title-single {
    font-size: var(--font-custom-32);
    font-weight: var(--font-weight-medium);
    line-height: var(--line-height-title);
    margin-bottom: var(--space-xs);  /* Tight coupling to metadata below */
    letter-spacing: var(--letter-spacing-tight-lg);
}

.essay-body,
.note-body {
    font-size: var(--font-lg);
    line-height: var(--line-height-body);

    /* Paragraphs */
    p {
        margin-bottom: var(--space-md);
        font-weight: var(--font-weight-normal);
        color: var(--text-primary);
    }

    /* Unordered lists */
    ul {
        margin: var(--space-md) 0;
        padding-left: var(--space-lg);
    }

    /* List items */
    li {
        margin-bottom: var(--space-xs);
        font-weight: var(--font-weight-normal);
        color: var(--text-primary);
    }

    /* Bold text - enhanced visibility */
    strong,
    b {
        font-weight: var(--font-weight-semibold);
        color: var(--text-bold);
    }

    /* Images - systematic elevation */
    img {
        box-shadow: var(--shadow-content-light);
        transition: box-shadow var(--transition-fast);
    }
}

/* Reading content uses primary color for optimal contrast */
.page-body p,
.page-body li,
.latest-essay p,
.podcast p {
    color: var(--text-primary);
}

/* Content heading spacing - unified hierarchy across essay/note/page bodies
   Philosophy: Clear visual hierarchy without excessive gaps
   H2 (24px top): Section breaks
   H3 (16px top): Subsection breaks
   H4 (12px top): Minor heading breaks */
.essay-body,
.note-body,
.page-body {
    h2 {
        margin-top: var(--space-lg);     /* 24px - section break */
        margin-bottom: var(--space-md);  /* 16px */
    }

    h3 {
        margin-top: var(--space-md);     /* 16px - subsection break */
        margin-bottom: var(--space-sm);  /* 12px */
    }

    h4 {
        margin-top: var(--space-sm);     /* 12px - minor heading break */
        margin-bottom: var(--space-xs);  /* 8px */
    }
}

/* First heading after page header elements - reduce top margin to avoid excessive stacking
   Applies when meta/title/subtitle elements precede the first content heading */
.essay-content > header + .essay-body > h2:first-child,
.note-content > header + .note-body > h2:first-child,
.page-body > h2:first-child,
.page-body > h3:first-child {
    margin-top: 0;  /* No top margin - header elements provide spacing */
}

.podcast-content > h3:first-child {
    margin-top: var(--space-md);  /* 16px - tighter spacing for podcast layout */
}

/* Footer CTA spacing after essay/note content */
.essay-body + footer,
.note-body + footer {
    margin-top: var(--space-sm);  /* 8px - tight spacing like p:has(+ .cta-link) */
}

/* ==========================================================================
   Markdown Elements - Shared Content Body Styles (CSS Nesting)
   Applied to both .essay-body and .note-body
   ========================================================================== */

.essay-body,
.note-body {
    /* Ordered Lists */
    ol {
        margin: var(--space-lg) 0;
        padding-left: var(--space-lg);

        li {
            margin-bottom: var(--space-xs);
        }
    }

    /* Nested Lists */
    li > ul,
    li > ol {
        margin: var(--space-xs) 0 0 0;
    }

    /* H6 special styling */
    h6 {
        margin-top: var(--space-md);
        text-transform: uppercase;
        letter-spacing: var(--letter-spacing-wide);
    }

    /* Blockquotes */
    blockquote {
        margin: var(--space-xl) 0;
        padding: var(--space-md) var(--space-lg);
        border-left: var(--border-width-accent) solid var(--brand-orange);
        background: var(--background-card);
        font-style: italic;
        color: var(--text-secondary);

        p {
            margin-bottom: var(--space-md);

            &:last-child {
                margin-bottom: 0;
            }
        }

        /* Nested blockquotes */
        blockquote {
            margin: var(--space-md) 0;
            border-left-color: var(--text-meta);
        }
    }

    /* Inline Code */
    code {
        font-family: var(--font-monospace);
        font-size: 0.9em;
        background: var(--background-card);
        padding: 0.2em 0.4em;
        border-radius: var(--border-radius-code);
        border: var(--border-width) solid var(--border-color);
        white-space: nowrap;
    }

    /* Code Blocks */
    pre {
        margin: var(--space-xl) 0;
        padding: var(--space-lg);
        background: var(--background-card);
        border: var(--border-width) solid var(--border-color);
        border-radius: var(--border-radius-code);
        overflow-x: auto;
        line-height: 1.5;

        code {
            background: none;
            padding: 0;
            border: none;
            border-radius: 0;
            font-size: 0.875rem;
        }
    }

    /* Syntax highlighted code (Hugo default) */
    .highlight {
        margin: var(--space-xl) 0;

        pre {
            margin: 0;
        }

        /* Syntax highlight color overrides - match code highlighter output colors */
        span[style*="color:#00a8c8"] {
            color: var(--syntax-keyword) !important;
        }

        span[style*="color:#75af00"] {
            color: var(--syntax-function) !important;
        }

        span[style*="color:#d88200"] {
            color: var(--syntax-string) !important;
        }

        span[style*="color:#f92672"] {
            color: var(--syntax-operator) !important;
        }

        span[style*="color:#111"] {
            color: var(--syntax-default) !important;
        }
    }

    /* Horizontal Rules */
    hr {
        margin: var(--space-2xl) 0;
        border: none;
        height: 1px;
        background: var(--border-color);
    }

    /* Tables */
    table {
        width: 100%;
        margin: var(--space-xl) 0;
        border-collapse: collapse;
        font-size: var(--font-base);

        th {
            padding: var(--table-cell-padding);
            text-align: left;
            font-weight: var(--font-weight-semibold);
            background: var(--background-card);
            border: var(--border-width) solid var(--border-color);

            &:last-child {
                text-align: right;
            }
        }

        td {
            padding: var(--table-cell-padding);
            border: var(--border-width) solid var(--border-color);

            &:last-child {
                text-align: right;
            }
        }

        tbody tr:nth-child(even) {
            background: var(--background-card);
        }
    }

    /* Task Lists */
    input[type="checkbox"] {
        margin-right: 0.5rem;
        vertical-align: middle;
        appearance: none;
        width: 1.1em;
        height: 1.1em;
        border: 2px solid var(--border-color);
        border-radius: var(--border-radius-code);
        background: var(--background-card);
        cursor: default;
        position: relative;
        flex-shrink: 0;

        &:checked {
            background: var(--text-meta);
            border-color: var(--text-meta);

            &::after {
                content: '✓';
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                color: white;
                font-size: 0.9em;
                font-weight: var(--font-weight-bold);
                line-height: 1;
            }
        }
    }

    li:has(input[type="checkbox"]) {
        list-style: none;

        &::marker {
            content: '';
            display: none;
        }

        input[type="checkbox"] {
            margin-left: -1.5rem;
            margin-right: 0.75rem;
        }
    }

    /* Definition Lists */
    dl {
        margin: var(--space-lg) 0;
    }

    dt {
        font-weight: var(--font-weight-semibold);
        margin-top: var(--space-md);

        &:first-child {
            margin-top: 0;
        }
    }

    dd {
        margin-left: var(--space-xl);
        margin-top: var(--space-xs);
        color: var(--text-secondary);
    }

    /* Footnotes */
    .footnotes {
        margin-top: var(--space-lg);
        margin-bottom: 0;  /* hr + li margins provide separation; avoid double-spacing before footer CTA */
        font-size: var(--font-sm);

        hr {
            margin: var(--space-lg) 0 var(--space-md) 0;
            opacity: 0.5;
        }

        ol {
            padding-left: var(--space-lg);
        }

        li {
            margin-bottom: var(--space-md);
            line-height: var(--line-height-body);
            color: var(--text-meta);
        }

        p {
            margin-bottom: var(--space-xs);
            color: var(--text-meta);
        }

        /* Subdued inline links - blend with footnote text, underline for affordance */
        /* Excludes backref arrows which keep their original orange styling */
        a:not(.footnote-backref) {
            color: var(--text-meta);
            text-decoration: underline;
            text-decoration-color: color-mix(in srgb, var(--text-meta) var(--underline-opacity), transparent);
            text-decoration-thickness: var(--underline-thickness);
            text-underline-offset: var(--underline-offset);

            &:hover {
                color: var(--brand-orange-hover);
                text-decoration-color: color-mix(in srgb, var(--brand-orange-hover) var(--underline-opacity), transparent);
            }
        }
    }

    /* Footnote back-references - subtle return arrows */
    .footnote-backref {
        margin-left: var(--space-xs);
        font-size: var(--font-base);
        opacity: 0.6;
    }

    .footnote-backref:hover {
        opacity: 1;
        text-decoration: none;
    }

    /* Images */
    img {
        max-width: 100%;
        height: auto;
        margin: var(--space-xl) 0;
        display: block;
    }

    /* Strikethrough */
    del {
        color: var(--text-meta);
        text-decoration: line-through;
    }

    /* Superscript & Subscript */
    sup,
    sub {
        font-size: 0.75em;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
    }

    sup {
        top: -0.5em;
    }

    sub {
        bottom: -0.25em;
    }

    /* Emphasis */
    em {
        font-style: italic;
    }
}

.essay-footer {
    margin-top: var(--space-md);
    padding-top: 0;
    border-top: none;
}

.essay-footer p {
    color: var(--text-secondary);
    margin-bottom: 0;
}

.essay-footer a {
    color: var(--brand-orange);
    text-decoration: none;
}

.essay-footer a:hover {
    color: var(--brand-orange-hover);
}

.essay-nav {
    border-bottom: none;
    padding-bottom: 0;
    margin-top: var(--space-lg);
    gap: 0;
}

.essay-nav .all-essays {
    color: var(--text-meta);
}

.essay-nav .all-essays:hover {
    color: var(--brand-orange);
}

.essay-acknowledgement {
    color: var(--text-meta);
    font-style: italic;
    font-size: var(--font-base);
    margin-bottom: 0;
}

/* Back links - unified styling for all back links */
.note-back-link,
.back-link,
.back-link-wrapper {
    margin-top: var(--space-lg);

    a,
    &.page-body a {
        color: var(--text-meta);
        text-decoration: none;
        font-size: var(--font-base);
        display: inline-flex;
        align-items: center;
        gap: var(--arrow-gap);

        &:hover {
            color: var(--brand-orange);
            text-decoration: none;
        }
    }
}

/* Standalone back-link anchor elements */
a.back-link {
    color: var(--text-meta);
    text-decoration: none;
    font-size: var(--font-base);
    display: inline-flex;
    align-items: center;
    gap: var(--arrow-gap);

    &:hover {
        color: var(--brand-orange);
        text-decoration: none;
    }
}

/* ==========================================================================
   Page-Specific Layout
   ========================================================================== */

/* Bio boxes on /media page */
.bio-text {
    background: var(--background-card);
    padding: var(--space-lg);
    color: var(--text-primary);
    margin-bottom: var(--space-lg);
    line-height: var(--line-height-body);
    font-size: var(--font-base);
}

.bio-text p:last-child {
    margin-bottom: 0;
}

.bio-text .info-pair:last-child {
    margin-bottom: 0;
}

/* ==========================================================================
   Page Content Wrappers
   ========================================================================== */

.page-content {
    max-width: var(--content-max-width);
}

/* Podcast page images */
.podcast-content img {
    margin: 0 0 var(--space-md) 0;
    display: block;
}

.podcast-content > img:first-of-type {
    width: var(--podcast-art-size);
    height: var(--podcast-art-size);
}

/* Image size utility - used via shortcode variant param */
.img-lg {
    display: block;
    width: var(--image-size-lg) !important;
    height: var(--image-size-lg) !important;
    margin-bottom: var(--space-lg);
}

/* ==========================================================================
   Pagination
   ========================================================================== */

.pagination {
    margin-top: var(--space-2xl);
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: var(--space-md);
}

/* Pagination styles consolidated with CTA links above */

/* ==========================================================================
   Contact Display Patterns
   Utility Pages - Vertical stack (.info-pair, .info-label, .info-value)
   ========================================================================== */

.info-pair {
    margin-bottom: var(--space-lg);
    display: flex;
    flex-direction: column;
    gap: var(--space-label-gap);

    /* Tighter spacing when followed by related download links */
    &:has(+ .download-link) {
        margin-bottom: var(--space-md);
    }

    /* Monospace code elements for fingerprints and keys - plain text, not links */
    code {
        font-family: var(--font-monospace);
        font-size: 0.9em;
        color: var(--text-primary);
        cursor: text;
    }
}

/* Media page contact section - tighter grouping for multiple contact methods */
#contact + .info-pair {
    margin-bottom: var(--space-lg);

    ~ .info-pair {
        margin-bottom: var(--space-lg);
    }
}

.info-label {
    font-weight: var(--font-weight-normal);
    color: var(--text-meta);
    font-size: var(--font-sm);
}

.info-value {
    color: var(--brand-orange);
    text-decoration: none;
    font-size: var(--font-base);
    transition: color var(--transition-fast);

    &:hover {
        color: var(--brand-orange-hover);
        text-decoration: underline;
        text-decoration-color: color-mix(in srgb, var(--brand-orange-hover) var(--underline-opacity), transparent);
        text-decoration-thickness: var(--underline-thickness);
        text-underline-offset: var(--underline-offset);
    }
}

/* ==========================================================================
   Skip Links (Keyboard Navigation)
   ========================================================================== */

.skip-link {
    position: fixed;
    top: 0;
    left: 0;
    background: var(--brand-orange);
    color: var(--text-on-brand);
    padding: 0.5rem 1rem;
    text-decoration: none;
    z-index: var(--z-skip-link);
    font-weight: var(--font-weight-medium);
    border-radius: 0 0 var(--border-radius-interactive) 0;
    transform: translateY(-100%);
    transition: transform 0.2s ease;
}

.skip-link:focus {
    transform: translateY(0);
}

/* ==========================================================================
   Utility Classes
   ========================================================================== */

.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
}

/* ==========================================================================
   FONT-WEIGHT & DARK MODE ARCHITECTURE

   PROBLEM: Theme toggle and CSS dark mode work differently:
   - Theme toggle: Sets data-theme="light|dark" attribute on <html>
   - Colors: Use light-dark() function which respects color-scheme property
   - CSS rules: html[data-theme="light|dark"] { color-scheme: light|dark; }
     makes light-dark() work correctly with the toggle

   BUT: @media (prefers-color-scheme: dark) checks SYSTEM preference,
   NOT the data-theme attribute! So font-weight rules inside the media
   query would apply based on system setting, ignoring user's toggle.

   SOLUTION:
   1. Base rules set light mode font-weight (450)
   2. Media query rules use html:not([data-theme="light"]) to skip when
      user explicitly chose light mode despite dark system
   3. Explicit html[data-theme="dark"] rules handle user toggling to dark
      when their system is in light mode
   ========================================================================== */

/* Base font-weight: light mode default (400) */
.essay-body p,
.essay-body li,
.note-body p,
.note-body li,
.page-body p,
.page-body li,
.latest-essay p {
    font-weight: var(--font-weight-normal);
}

/* ==========================================================================
   Dark Mode Overrides (System Preference)

   These rules apply when SYSTEM prefers dark AND user hasn't explicitly
   toggled to light mode via data-theme="light"
   ========================================================================== */

@media (prefers-color-scheme: dark) {
    /* Typography - Enhanced heading contrast in dark mode */
    h2 { color: var(--text-heading-h2); }
    h3 { color: var(--text-heading-h3); }
    h4 { color: var(--text-heading-h4); }
    h5, h6 { color: var(--text-heading-h5); }

    /* Headings - maintain weight hierarchy in dark mode */
    h1,
    .page-title,
    h2, h3, h4, h5, h6,
    .essay-title-single,
    .note-title-single {
        font-weight: var(--font-weight-semibold);
    }

    /* Body text - lighter weight in dark mode (only when user hasn't chosen light) */
    html:not([data-theme="light"]) p,
    html:not([data-theme="light"]) li {
        font-weight: var(--font-weight-normal);
    }

    /* Episode tag - lighter weight in dark mode */
    .episode-tag {
        font-weight: var(--font-weight-light);
    }

    /* Long-form reading - only when user hasn't explicitly chosen light mode */
    html:not([data-theme="light"]) .essay-body p,
    html:not([data-theme="light"]) .essay-body li,
    html:not([data-theme="light"]) .note-body p,
    html:not([data-theme="light"]) .note-body li,
    html:not([data-theme="light"]) .page-body p,
    html:not([data-theme="light"]) .page-body li,
    html:not([data-theme="light"]) .latest-essay p {
        font-weight: var(--font-weight-light);
    }

    /* Bold text - semibold for emphasis, size/context separates from headings */
    .essay-body strong,
    .essay-body b,
    .note-body strong,
    .note-body b,
    .page-body strong,
    .page-body b {
        font-weight: var(--font-weight-semibold);
    }

    /* Syntax Highlighting - Code blocks */
    .essay-body .highlight pre,
    .note-body .highlight pre {
        background: var(--code-background) !important;
        border-color: var(--border-color);
    }

    .essay-body .highlight pre[style],
    .note-body .highlight pre[style] {
        background: var(--code-background) !important;
        color: #d0d0d0 !important;
    }
}

/* ==========================================================================
   Dark Mode Overrides (Explicit Toggle)

   These rules apply when user explicitly toggled to dark mode via the
   theme toggle (data-theme="dark"), regardless of system preference.
   Needed for when system is light but user wants dark mode.
   ========================================================================== */

html[data-theme="dark"] p,
html[data-theme="dark"] li {
    font-weight: var(--font-weight-normal);
}

html[data-theme="dark"] .essay-body p,
html[data-theme="dark"] .essay-body li,
html[data-theme="dark"] .note-body p,
html[data-theme="dark"] .note-body li,
html[data-theme="dark"] .page-body p,
html[data-theme="dark"] .page-body li,
html[data-theme="dark"] .latest-essay p {
    font-weight: var(--font-weight-light);
}

/* ==========================================================================
   Print Styles
   ========================================================================== */

@media print {
    body::before, nav, footer, .podcast, .topic-tags {
        display: none;
    }
    body { background: white; color: black; }
    a { color: black; text-decoration: underline; }
}

/* ==========================================================================
   YouTube Embeds and Captions
   ========================================================================== */

/* Add extra spacing after "Recent speaking" heading */
#recent-speaking {
    margin-bottom: var(--space-lg);
}

/* Add spacing after YouTube embeds (both standard and preview versions) */
div[style*="padding-bottom: 56.25%"],
.youtube-preview-container {
    margin-bottom: var(--space-xl);
}

/* YouTube preview shortcode styles */
.youtube-preview-container {
    position: relative;
    padding-bottom: 56.25%;  /* 16:9 aspect ratio */
    height: 0;
    overflow: hidden;
    cursor: pointer;

    img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: 0;
    }
}

.play-button-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80px;
    height: 80px;
    background: rgba(255, 0, 0, 0.9);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;

    svg {
        margin-left: 4px;
    }
}

/* Style paragraphs that follow YouTube embeds as captions */
div[style*="padding-bottom: 56.25%"] + p,
.youtube-preview-container + p {
    font-size: var(--font-sm);
    color: var(--text-secondary);
    margin-top: calc(var(--space-xl) * -0.5);  /* Pull caption closer to video */
    margin-bottom: var(--space-xl);
}

/* Strong text within captions (event/panel titles) */
div[style*="padding-bottom: 56.25%"] + p strong,
.youtube-preview-container + p strong {
    font-weight: var(--font-weight-semibold);
    font-style: normal;
    color: var(--text-primary);
}

/* ==========================================================================
   Mobile Responsive Styles
   Mobile breakpoint: 600px - hardcoded because CSS variables don't work in media queries
   ========================================================================== */

@media (max-width: 600px) {
    html { font-size: 16px; }
    .container { padding: var(--space-lg) var(--space-md) 0 var(--space-md); }
    body > .container > header { flex-direction: column; align-items: flex-start; gap: var(--space-xs); }
    header .site-title, header h1.site-title { margin-bottom: 0; }
    .email-form input[type="email"] { max-width: none; }
    .footer-links a[aria-label="Value for value"]::after {
        content: "";
        position: absolute;
        inset: -16px -18px;
    }
    .podcast-header { flex-direction: column; align-items: flex-start; }
    .podcast-art { width: 130px; height: 130px; }
    .podcast-links { margin-top: 0; }
    .pagination { flex-direction: column; align-items: flex-start; }
    .info-pair code {
        white-space: pre-line;     /* Preserve newlines, wrap at spaces (fingerprints) */
        overflow-wrap: break-word; /* Break long words if needed (npubs, keys) */
    }
}
